{
  "version": 3,
  "sources": ["../bundle-FuOJHY/checked-fetch.js", "../pages-cxfEwt/bundle-Omh87Y/checked-fetch.js", "../../functions/api/ai/translate.ts", "../../functions/api/db/price-rules.ts", "../../functions/api/db/products.ts", "../../functions/api/db/sync.ts", "../../functions/api/db/tokens.ts", "../../functions/api/shopee/add_item.ts", "../../functions/api/shopee/attributes.ts", "../../functions/api/shopee/auth.ts", "../../functions/api/shopee/categories.ts", "../../functions/api/shopee/exchange.ts", "../../functions/api/shopee/item_detail.ts", "../../functions/api/shopee/logistics.ts", "../../functions/api/shopee/orders.ts", "../../functions/api/shopee/products.ts", "../../functions/api/shopee/test-connection.ts", "../../functions/api/shopee/update.ts", "../../functions/api/shopee/upload.ts", "../../functions/api/callback.ts", "../pages-cxfEwt/functionsWorker-0.13440977921841457.mjs/functionsRoutes-0.3738734451103618.mjs", "../../node_modules/path-to-regexp/src/index.ts", "../../node_modules/wrangler/templates/pages-template-worker.ts", "../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../pages-cxfEwt/bundle-Omh87Y/middleware-insertion-facade.js", "../../node_modules/wrangler/templates/middleware/common.ts", "../pages-cxfEwt/bundle-Omh87Y/middleware-loader.entry.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-FuOJHY/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-FuOJHY/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\buyse\\OneDrive\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\Antigravity\\Shopee Auto\\project\\.wrangler\\tmp\\dev-n2MN0D",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\r\n * OpenAI \u7FFB\u8A33 API\r\n * \r\n * \u65E5\u672C\u8A9E\u3092\u7E41\u4F53\u5B57\u4E2D\u56FD\u8A9E\uFF08\u53F0\u6E7E\uFF09\u306B\u7FFB\u8A33\u3057\u307E\u3059\r\n */\r\n\r\ninterface Env {\r\n    OPENAI_API_KEY: string;\r\n}\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    if (request.method !== \"POST\") {\r\n        return errorResponse(\"Method not allowed\", 405);\r\n    }\r\n\r\n    try {\r\n        const apiKey = env.OPENAI_API_KEY;\r\n        if (!apiKey) {\r\n            return errorResponse(\"OPENAI_API_KEY is not configured\", 500);\r\n        }\r\n\r\n        const body = await request.json() as { text: string; target_lang?: string };\r\n        const { text, target_lang = \"Traditional Chinese (Taiwan)\" } = body;\r\n\r\n        if (!text) {\r\n            return errorResponse(\"text is required\", 400);\r\n        }\r\n\r\n        const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Authorization\": `Bearer ${apiKey}`\r\n            },\r\n            body: JSON.stringify({\r\n                model: \"gpt-4o-mini\",\r\n                messages: [\r\n                    {\r\n                        role: \"system\",\r\n                        content: `\u4F60\u662F\u5C08\u696D\u7684\u65E5\u672C\u52D5\u6F2B\u516C\u4ED4\u7FFB\u8B6F\u5C08\u5BB6\uFF0C\u5C08\u9580\u70BA\u53F0\u7063\u96FB\u5546\u5E02\u5834\u7FFB\u8B6F\u5546\u54C1\u540D\u7A31\u3002\r\n\r\n\u3010\u91CD\u8981\u7FFB\u8B6F\u898F\u5247\u3011\r\n\r\n** \u516C\u4ED4\u7CFB\u5217\u540D\u7A31\u5FC5\u9808\u7FFB\u8B6F\uFF1A**\r\n- \u306D\u3093\u3069\u308D\u3044\u3069 / Nendoroid \u2192 \u9ECF\u571F\u4EBA\r\n- figma \u2192 figma\uFF08\u7DAD\u6301\u539F\u6587\uFF09\r\n- Qposket / Q posket \u2192 Q\u7248\r\n- \u4E00\u756A\u304F\u3058 / \u4E00\u756A\u8CDE \u2192 \u4E00\u756A\u8CDE\r\n- \u30D7\u30E9\u30A4\u30BA / Prize \u2192 \u666F\u54C1\r\n- ARTFX \u2192 ARTFX\uFF08\u7DAD\u6301\u539F\u6587\uFF09\r\n- POP UP PARADE \u2192 POP UP PARADE\uFF08\u7DAD\u6301\u539F\u6587\uFF09\r\n- \u30B9\u30B1\u30FC\u30EB\u30D5\u30A3\u30AE\u30E5\u30A2 \u2192 \u6BD4\u4F8B\u6A21\u578B\r\n\r\n**\u89D2\u8272\u540D\u7A31\u5FC5\u9808\u4F7F\u7528\u53F0\u7063\u5B98\u65B9\u8B6F\u540D\uFF1A**\r\n- \u521D\u97F3\u30DF\u30AF \u2192 \u521D\u97F3\u672A\u4F86\r\n- \u9B3C\u6EC5\u306E\u5203 \u2192 \u9B3C\u6EC5\u4E4B\u5203\r\n- \u7AC8\u9580\u70AD\u6CBB\u90CE \u2192 \u7AC8\u9580\u70AD\u6CBB\u90CE\r\n- \u6211\u59BB\u5584\u9038 \u2192 \u6211\u59BB\u5584\u9038\r\n- \u546A\u8853\u5EFB\u6226 \u2192 \u5492\u8853\u8FF4\u6230\r\n- \u4E94\u6761\u609F \u2192 \u4E94\u689D\u609F\r\n- SPY\u00D7FAMILY \u2192 SPY\u00D7FAMILY\r\n- \u30A2\u30FC\u30CB\u30E3 \u2192 \u5B89\u59AE\u4E9E\r\n- \u63A8\u3057\u306E\u5B50 \u2192 \u6211\u63A8\u7684\u5B69\u5B50\r\n- \u30EF\u30F3\u30D4\u30FC\u30B9 \u2192 \u6D77\u8CCA\u738B/\u822A\u6D77\u738B\r\n- \u30EB\u30D5\u30A3 \u2192 \u9B6F\u592B\r\n- \u30C9\u30E9\u30B4\u30F3\u30DC\u30FC\u30EB \u2192 \u4E03\u9F8D\u73E0\r\n- \u5B6B\u609F\u7A7A \u2192 \u5B6B\u609F\u7A7A\r\n- \u30CA\u30EB\u30C8 \u2192 \u706B\u5F71\u5FCD\u8005\r\n- \u9032\u6483\u306E\u5DE8\u4EBA \u2192 \u9032\u64CA\u7684\u5DE8\u4EBA\r\n\r\n**\u5546\u54C1\u72C0\u614B\u8853\u8A9E\uFF1A**\r\n- \u672A\u958B\u5C01 \u2192 \u5168\u65B0\u672A\u62C6\r\n- \u65B0\u54C1 \u2192 \u5168\u65B0\r\n- \u7BB1\u306A\u3057 \u2192 \u7121\u76D2\r\n- \u521D\u7248/\u521D\u56DE \u2192 \u521D\u7248\r\n- \u65E5\u7248 \u2192 \u65E5\u7248\r\n- Ver. / \u30D0\u30FC\u30B8\u30E7\u30F3 \u2192 Ver.\r\n\r\n**\u54C1\u724C\u4FDD\u6301\u82F1\u6587\uFF1A**\r\nBANPRESTO, SEGA, TAITO, Good Smile Company, Kotobukiya, MegaHouse, BANDAI\r\n\r\n\u3010\u8F38\u51FA\u683C\u5F0F\u3011\r\n\u53EA\u8F38\u51FA\u7FFB\u8B6F\u7D50\u679C\uFF0C\u4E0D\u8981\u4EFB\u4F55\u89E3\u91CB\u6216\u984D\u5916\u6587\u5B57\u3002`\r\n                    },\r\n                    {\r\n                        role: \"user\",\r\n                        content: text\r\n                    }\r\n                ],\r\n                temperature: 0.1\r\n            })\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.error) {\r\n            console.error(\"OpenAI API Error:\", data.error);\r\n            return errorResponse(`OpenAI Error: ${data.error.message}`, 500);\r\n        }\r\n\r\n        const translatedText = data.choices[0]?.message?.content?.trim() || \"\";\r\n\r\n        return new Response(JSON.stringify({\r\n            status: \"success\",\r\n            translation: translatedText\r\n        }), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Translation error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * D1 Database Price Rules API\r\n * \u4FA1\u683C\u8ABF\u6574\u30EB\u30FC\u30EB\u306ECRUD\u64CD\u4F5C\r\n */\r\n\r\ninterface Env {\r\n    DB: D1Database;\r\n}\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n    try {\r\n        switch (request.method) {\r\n            case \"GET\":\r\n                return await handleGet(env.DB, shopId, url);\r\n            case \"POST\":\r\n                return await handlePost(env.DB, request);\r\n            case \"PUT\":\r\n                return await handlePut(env.DB, request);\r\n            case \"DELETE\":\r\n                return await handleDelete(env.DB, url);\r\n            default:\r\n                return errorResponse(\"Method not allowed\", 405);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Database error:\", error);\r\n        return errorResponse(`Database error: ${error}`, 500);\r\n    }\r\n};\r\n\r\n/**\r\n * GET: \u4FA1\u683C\u30EB\u30FC\u30EB\u4E00\u89A7\u307E\u305F\u306F\u5358\u4E00\u30EB\u30FC\u30EB\u3092\u53D6\u5F97\r\n */\r\nasync function handleGet(db: D1Database, shopId: string | null, url: URL): Promise<Response> {\r\n    const ruleId = url.searchParams.get(\"id\");\r\n\r\n    if (ruleId) {\r\n        const result = await db.prepare(\r\n            \"SELECT * FROM price_rules WHERE id = ?\"\r\n        ).bind(ruleId).first();\r\n\r\n        if (!result) {\r\n            return errorResponse(\"Rule not found\", 404);\r\n        }\r\n\r\n        return jsonResponse({ status: \"success\", data: result });\r\n    }\r\n\r\n    // \u30EB\u30FC\u30EB\u4E00\u89A7\u53D6\u5F97\r\n    let query = \"SELECT * FROM price_rules\";\r\n    const params: any[] = [];\r\n\r\n    if (shopId) {\r\n        query += \" WHERE shop_id = ?\";\r\n        params.push(shopId);\r\n    }\r\n\r\n    query += \" ORDER BY priority DESC, created_at DESC\";\r\n\r\n    const results = await db.prepare(query).bind(...params).all();\r\n\r\n    return jsonResponse({\r\n        status: \"success\",\r\n        data: results.results\r\n    });\r\n}\r\n\r\n/**\r\n * POST: \u4FA1\u683C\u30EB\u30FC\u30EB\u3092\u8FFD\u52A0\r\n */\r\nasync function handlePost(db: D1Database, request: Request): Promise<Response> {\r\n    const rule = await request.json() as any;\r\n\r\n    if (!rule.shop_id || !rule.name || !rule.rule_type) {\r\n        return errorResponse(\"shop_id, name, and rule_type are required\", 400);\r\n    }\r\n\r\n    const result = await db.prepare(`\r\n        INSERT INTO price_rules (\r\n            shop_id, name, description, rule_type,\r\n            adjustment_value, adjustment_direction,\r\n            min_price, max_price, min_margin_percent,\r\n            apply_to_category, apply_to_tags,\r\n            is_active, priority\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n        rule.shop_id,\r\n        rule.name,\r\n        rule.description || null,\r\n        rule.rule_type,\r\n        rule.adjustment_value || null,\r\n        rule.adjustment_direction || \"decrease\",\r\n        rule.min_price || null,\r\n        rule.max_price || null,\r\n        rule.min_margin_percent || null,\r\n        rule.apply_to_category || null,\r\n        rule.apply_to_tags ? JSON.stringify(rule.apply_to_tags) : null,\r\n        rule.is_active !== false ? 1 : 0,\r\n        rule.priority || 0\r\n    ).run();\r\n\r\n    return jsonResponse({\r\n        status: \"success\",\r\n        message: \"Price rule created\",\r\n        data: { id: result.meta.last_row_id }\r\n    });\r\n}\r\n\r\n/**\r\n * PUT: \u4FA1\u683C\u30EB\u30FC\u30EB\u3092\u66F4\u65B0\r\n */\r\nasync function handlePut(db: D1Database, request: Request): Promise<Response> {\r\n    const { id, ...updates } = await request.json() as any;\r\n\r\n    if (!id) {\r\n        return errorResponse(\"id is required\", 400);\r\n    }\r\n\r\n    const updateFields: string[] = [];\r\n    const params: any[] = [];\r\n\r\n    const allowedFields = [\r\n        \"name\", \"description\", \"rule_type\", \"adjustment_value\",\r\n        \"adjustment_direction\", \"min_price\", \"max_price\",\r\n        \"min_margin_percent\", \"apply_to_category\", \"is_active\", \"priority\"\r\n    ];\r\n\r\n    for (const field of allowedFields) {\r\n        if (updates[field] !== undefined) {\r\n            updateFields.push(`${field} = ?`);\r\n            if (field === \"is_active\") {\r\n                params.push(updates[field] ? 1 : 0);\r\n            } else {\r\n                params.push(updates[field]);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (updates.apply_to_tags !== undefined) {\r\n        updateFields.push(\"apply_to_tags = ?\");\r\n        params.push(JSON.stringify(updates.apply_to_tags));\r\n    }\r\n\r\n    updateFields.push(\"updated_at = datetime('now')\");\r\n    params.push(id);\r\n\r\n    await db.prepare(\r\n        `UPDATE price_rules SET ${updateFields.join(\", \")} WHERE id = ?`\r\n    ).bind(...params).run();\r\n\r\n    return jsonResponse({ status: \"success\", message: \"Price rule updated\" });\r\n}\r\n\r\n/**\r\n * DELETE: \u4FA1\u683C\u30EB\u30FC\u30EB\u3092\u524A\u9664\r\n */\r\nasync function handleDelete(db: D1Database, url: URL): Promise<Response> {\r\n    const id = url.searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n        return errorResponse(\"id is required\", 400);\r\n    }\r\n\r\n    // \u95A2\u9023\u3059\u308B\u5546\u54C1\u306Eprice_rule_id\u3092null\u306B\r\n    await db.prepare(\r\n        \"UPDATE products SET price_rule_id = NULL WHERE price_rule_id = ?\"\r\n    ).bind(id).run();\r\n\r\n    await db.prepare(\"DELETE FROM price_rules WHERE id = ?\").bind(id).run();\r\n\r\n    return jsonResponse({ status: \"success\", message: \"Price rule deleted\" });\r\n}\r\n\r\n// \u30D8\u30EB\u30D1\u30FC\u95A2\u6570\r\nfunction jsonResponse(data: any, status = 200): Response {\r\n    return new Response(JSON.stringify(data), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() }\r\n    });\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return jsonResponse({ status: \"error\", message }, status);\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\"\r\n    };\r\n}\r\n", "/**\r\n * D1 Database Products API (Shopee API\u7D71\u4E00\u7248)\r\n * \u5546\u54C1\u30C7\u30FC\u30BF\u306ECRUD\u64CD\u4F5C - Shopee API\u30D1\u30E9\u30E1\u30FC\u30BF\u3068\u5B8C\u5168\u7D71\u4E00\r\n */\r\n\r\ninterface Env {\r\n    DB: D1Database;\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n    try {\r\n        switch (request.method) {\r\n            case \"GET\":\r\n                return await handleGet(env.DB, shopId, url);\r\n            case \"POST\":\r\n                return await handlePost(env.DB, request);\r\n            case \"PUT\":\r\n                return await handlePut(env.DB, request);\r\n            case \"DELETE\":\r\n                return await handleDelete(env.DB, url);\r\n            default:\r\n                return errorResponse(\"Method not allowed\", 405);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Database error:\", error);\r\n        return errorResponse(`Database error: ${error}`, 500);\r\n    }\r\n};\r\n\r\n/**\r\n * GET: \u5546\u54C1\u4E00\u89A7\u307E\u305F\u306F\u5358\u4E00\u5546\u54C1\u3092\u53D6\u5F97\r\n */\r\nasync function handleGet(db: D1Database, shopId: string | null, url: URL): Promise<Response> {\r\n    const productId = url.searchParams.get(\"id\");\r\n    const itemId = url.searchParams.get(\"item_id\");\r\n    const status = url.searchParams.get(\"item_status\") || url.searchParams.get(\"status\");\r\n    const limit = parseInt(url.searchParams.get(\"limit\") || \"100\");\r\n    const offset = parseInt(url.searchParams.get(\"offset\") || \"0\");\r\n\r\n    if (productId) {\r\n        const result = await db.prepare(\"SELECT * FROM products WHERE id = ?\").bind(productId).first();\r\n        if (!result) return errorResponse(\"Product not found\", 404);\r\n        return jsonResponse({ status: \"success\", data: parseProduct(result) });\r\n    }\r\n\r\n    if (itemId) {\r\n        const result = await db.prepare(\"SELECT * FROM products WHERE item_id = ?\").bind(itemId).first();\r\n        return jsonResponse({ status: \"success\", data: result ? parseProduct(result) : null });\r\n    }\r\n\r\n    // \u5546\u54C1\u4E00\u89A7\u53D6\u5F97\r\n    let query = \"SELECT * FROM products WHERE 1=1\";\r\n    const params: any[] = [];\r\n\r\n    if (shopId) {\r\n        query += \" AND shop_id = ?\";\r\n        params.push(parseInt(shopId));\r\n    }\r\n\r\n    if (status && status !== \"all\") {\r\n        query += \" AND item_status = ?\";\r\n        params.push(status.toUpperCase());\r\n    }\r\n\r\n    query += \" ORDER BY update_time DESC LIMIT ? OFFSET ?\";\r\n    params.push(limit, offset);\r\n\r\n    const results = await db.prepare(query).bind(...params).all();\r\n\r\n    // \u7DCF\u6570\u3092\u53D6\u5F97\r\n    let countQuery = \"SELECT COUNT(*) as total FROM products WHERE 1=1\";\r\n    const countParams: any[] = [];\r\n    if (shopId) {\r\n        countQuery += \" AND shop_id = ?\";\r\n        countParams.push(parseInt(shopId));\r\n    }\r\n    if (status && status !== \"all\") {\r\n        countQuery += \" AND item_status = ?\";\r\n        countParams.push(status.toUpperCase());\r\n    }\r\n    const countResult = await db.prepare(countQuery).bind(...countParams).first<{ total: number }>();\r\n\r\n    // JSON\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u30D1\u30FC\u30B9\r\n    const products = results.results.map(parseProduct);\r\n\r\n    return jsonResponse({\r\n        status: \"success\",\r\n        data: {\r\n            products,\r\n            total: countResult?.total || 0,\r\n            limit,\r\n            offset\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * POST: \u5546\u54C1\u3092\u8FFD\u52A0\uFF08Shopee add_item\u4E92\u63DB\uFF09\r\n */\r\nasync function handlePost(db: D1Database, request: Request): Promise<Response> {\r\n    const product = await request.json() as any;\r\n\r\n    // Shopee add_item API\u3068\u540C\u3058\u30D1\u30E9\u30E1\u30FC\u30BF\u540D\u3092\u4F7F\u7528\r\n    const result = await db.prepare(`\r\n        INSERT INTO products (\r\n            item_id, shop_id, item_name, description, description_type, item_sku,\r\n            category_id, original_price, current_price, currency, stock,\r\n            image_url, image_url_list, image_id_list, weight,\r\n            package_length, package_width, package_height,\r\n            condition, item_status, attribute_list, logistic_info,\r\n            has_model, model_list, pre_order_days_to_ship, brand_id,\r\n            wholesale_list, video_info, custom_price, cost_price, source_url, notes, tags\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n        product.item_id || null,\r\n        product.shop_id,\r\n        product.item_name,\r\n        product.description || null,\r\n        product.description_type || 'normal',\r\n        product.item_sku || null,\r\n        product.category_id || null,\r\n        product.original_price || null,\r\n        product.current_price || product.original_price || null,\r\n        product.currency || 'TWD',\r\n        product.stock || 0,\r\n        Array.isArray(product.image_url_list) ? product.image_url_list[0] : (product.image_url || null),\r\n        JSON.stringify(product.image_url_list || product.image?.image_url_list || []),\r\n        JSON.stringify(product.image_id_list || product.image?.image_id_list || []),\r\n        product.weight || null,\r\n        product.dimension?.package_length || product.package_length || null,\r\n        product.dimension?.package_width || product.package_width || null,\r\n        product.dimension?.package_height || product.package_height || null,\r\n        product.condition || 'NEW',\r\n        product.item_status || 'NORMAL',\r\n        JSON.stringify(product.attribute_list || []),\r\n        JSON.stringify(product.logistic_info || []),\r\n        product.has_model ? 1 : 0,\r\n        JSON.stringify(product.model_list || []),\r\n        product.pre_order?.days_to_ship || product.pre_order_days_to_ship || null,\r\n        product.brand?.brand_id || product.brand_id || null,\r\n        JSON.stringify(product.wholesale || []),\r\n        JSON.stringify(product.video_info || null),\r\n        product.custom_price || null,\r\n        product.cost_price || null,\r\n        product.source_url || null,\r\n        product.notes || null,\r\n        JSON.stringify(product.tags || [])\r\n    ).run();\r\n\r\n    return jsonResponse({\r\n        status: \"success\",\r\n        message: \"Product created\",\r\n        data: { id: result.meta.last_row_id }\r\n    });\r\n}\r\n\r\n/**\r\n * PUT: \u5546\u54C1\u3092\u66F4\u65B0\uFF08Shopee update_item\u4E92\u63DB\uFF09\r\n */\r\nasync function handlePut(db: D1Database, request: Request): Promise<Response> {\r\n    const body = await request.json() as any;\r\n    const { id, item_id, ...updates } = body;\r\n\r\n    if (!id && !item_id) {\r\n        return errorResponse(\"id or item_id required\", 400);\r\n    }\r\n\r\n    // \u73FE\u5728\u306E\u4FA1\u683C\u3092\u53D6\u5F97\uFF08\u5C65\u6B74\u7528\uFF09\r\n    const current = await db.prepare(\r\n        \"SELECT id, item_id, current_price FROM products WHERE \" + (id ? \"id = ?\" : \"item_id = ?\")\r\n    ).bind(id || item_id).first<{ id: number, item_id: number, current_price: number }>();\r\n\r\n    // \u66F4\u65B0\u53EF\u80FD\u30D5\u30A3\u30FC\u30EB\u30C9\uFF08Shopee API\u4E92\u63DB\uFF09\r\n    const updateFields: string[] = [];\r\n    const params: any[] = [];\r\n\r\n    const fieldMapping: Record<string, string> = {\r\n        item_name: 'item_name',\r\n        description: 'description',\r\n        description_type: 'description_type',\r\n        item_sku: 'item_sku',\r\n        category_id: 'category_id',\r\n        original_price: 'original_price',\r\n        current_price: 'current_price',\r\n        stock: 'stock',\r\n        weight: 'weight',\r\n        package_length: 'package_length',\r\n        package_width: 'package_width',\r\n        package_height: 'package_height',\r\n        condition: 'condition',\r\n        item_status: 'item_status',\r\n        custom_price: 'custom_price',\r\n        cost_price: 'cost_price',\r\n        source_url: 'source_url',\r\n        notes: 'notes',\r\n        price_rule_id: 'price_rule_id',\r\n        auto_adjust_enabled: 'auto_adjust_enabled',\r\n        min_price: 'min_price',\r\n        max_price: 'max_price'\r\n    };\r\n\r\n    for (const [key, dbField] of Object.entries(fieldMapping)) {\r\n        if (updates[key] !== undefined) {\r\n            updateFields.push(`${dbField} = ?`);\r\n            params.push(updates[key]);\r\n        }\r\n    }\r\n\r\n    // JSON \u30D5\u30A3\u30FC\u30EB\u30C9\r\n    if (updates.attribute_list !== undefined) {\r\n        updateFields.push(\"attribute_list = ?\");\r\n        params.push(JSON.stringify(updates.attribute_list));\r\n    }\r\n    if (updates.logistic_info !== undefined) {\r\n        updateFields.push(\"logistic_info = ?\");\r\n        params.push(JSON.stringify(updates.logistic_info));\r\n    }\r\n    if (updates.image_url_list !== undefined) {\r\n        updateFields.push(\"image_url_list = ?\");\r\n        params.push(JSON.stringify(updates.image_url_list));\r\n        if (updates.image_url_list.length > 0) {\r\n            updateFields.push(\"image_url = ?\");\r\n            params.push(updates.image_url_list[0]);\r\n        }\r\n    }\r\n    if (updates.tags !== undefined) {\r\n        updateFields.push(\"tags = ?\");\r\n        params.push(JSON.stringify(updates.tags));\r\n    }\r\n\r\n    updateFields.push(\"updated_at = datetime('now')\");\r\n    params.push(id || item_id);\r\n\r\n    if (updateFields.length === 1) {\r\n        return errorResponse(\"No valid fields to update\", 400);\r\n    }\r\n\r\n    await db.prepare(\r\n        `UPDATE products SET ${updateFields.join(\", \")} WHERE ` + (id ? \"id = ?\" : \"item_id = ?\")\r\n    ).bind(...params).run();\r\n\r\n    // \u4FA1\u683C\u5909\u66F4\u5C65\u6B74\u3092\u8A18\u9332\r\n    if ((updates.current_price !== undefined || updates.custom_price !== undefined) && current) {\r\n        const newPrice = updates.custom_price || updates.current_price;\r\n        await db.prepare(`\r\n            INSERT INTO price_history (product_id, item_id, old_price, new_price, change_reason, price_rule_id)\r\n            VALUES (?, ?, ?, ?, ?, ?)\r\n        `).bind(\r\n            current.id,\r\n            current.item_id,\r\n            current.current_price,\r\n            newPrice,\r\n            updates.change_reason || \"manual\",\r\n            updates.price_rule_id || null\r\n        ).run();\r\n    }\r\n\r\n    return jsonResponse({ status: \"success\", message: \"Product updated\" });\r\n}\r\n\r\n/**\r\n * DELETE: \u5546\u54C1\u3092\u524A\u9664\r\n */\r\nasync function handleDelete(db: D1Database, url: URL): Promise<Response> {\r\n    const id = url.searchParams.get(\"id\");\r\n    const itemId = url.searchParams.get(\"item_id\");\r\n\r\n    if (!id && !itemId) {\r\n        return errorResponse(\"id or item_id required\", 400);\r\n    }\r\n\r\n    await db.prepare(\r\n        \"DELETE FROM products WHERE \" + (id ? \"id = ?\" : \"item_id = ?\")\r\n    ).bind(id || itemId).run();\r\n\r\n    return jsonResponse({ status: \"success\", message: \"Product deleted\" });\r\n}\r\n\r\n/**\r\n * JSON\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u30D1\u30FC\u30B9\u3057\u3066\u8FD4\u3059\r\n */\r\nfunction parseProduct(row: any): any {\r\n    return {\r\n        ...row,\r\n        image_url_list: safeJsonParse(row.image_url_list, []),\r\n        image_id_list: safeJsonParse(row.image_id_list, []),\r\n        attribute_list: safeJsonParse(row.attribute_list, []),\r\n        logistic_info: safeJsonParse(row.logistic_info, []),\r\n        model_list: safeJsonParse(row.model_list, []),\r\n        wholesale_list: safeJsonParse(row.wholesale_list, []),\r\n        video_info: safeJsonParse(row.video_info, null),\r\n        tags: safeJsonParse(row.tags, []),\r\n        has_model: !!row.has_model,\r\n        auto_adjust_enabled: !!row.auto_adjust_enabled\r\n    };\r\n}\r\n\r\nfunction safeJsonParse(str: string | null, defaultValue: any): any {\r\n    if (!str) return defaultValue;\r\n    try {\r\n        return JSON.parse(str);\r\n    } catch {\r\n        return defaultValue;\r\n    }\r\n}\r\n\r\n// \u30D8\u30EB\u30D1\u30FC\u95A2\u6570\r\nfunction jsonResponse(data: any, status = 200): Response {\r\n    return new Response(JSON.stringify(data), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() }\r\n    });\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return jsonResponse({ status: \"error\", message }, status);\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\"\r\n    };\r\n}\r\n", "/**\r\n * D1 Database Sync API (Shopee API\u7D71\u4E00\u7248)\r\n * Shopee\u30C7\u30FC\u30BF\u3092Shopee API\u30D1\u30E9\u30E1\u30FC\u30BF\u3068\u5B8C\u5168\u306B\u7D71\u4E00\u3057\u3066D1\u306B\u4FDD\u5B58\r\n */\r\n\r\ninterface Env {\r\n    DB: D1Database;\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    if (request.method !== \"POST\") {\r\n        return errorResponse(\"Method not allowed\", 405);\r\n    }\r\n\r\n    const accessToken = url.searchParams.get(\"access_token\");\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n    if (!accessToken || !shopId) {\r\n        return errorResponse(\"access_token and shop_id required\", 400);\r\n    }\r\n\r\n    try {\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        // 1. Shopee\u304B\u3089\u5168\u5546\u54C1\u3092\u53D6\u5F97\r\n        const allProducts: any[] = [];\r\n        let offset = 0;\r\n        let hasMore = true;\r\n        let debugInfo: any[] = [];\r\n\r\n        while (hasMore) {\r\n            const result = await getItemList(partnerId, partnerKey, accessToken, parseInt(shopId), offset);\r\n\r\n            // \u30C7\u30D0\u30C3\u30B0\u60C5\u5831\u3092\u8A18\u9332\r\n            debugInfo.push({\r\n                offset,\r\n                hasError: !!result.error,\r\n                errorMessage: result.error || result.message,\r\n                itemCount: result.response?.item?.length || 0,\r\n                hasNextPage: result.response?.has_next_page\r\n            });\r\n\r\n            if (result.error) {\r\n                // \u30A8\u30E9\u30FC\u306E\u5834\u5408\u306F\u8A73\u7D30\u60C5\u5831\u3092\u8FD4\u3059\r\n                return jsonResponse({\r\n                    status: \"error\",\r\n                    message: `Shopee API error: ${result.error} - ${result.message || ''}`,\r\n                    debug: debugInfo\r\n                }, 400);\r\n            }\r\n\r\n            if (!result.response?.item || result.response.item.length === 0) {\r\n                // \u5546\u54C1\u304C\u306A\u3044\u5834\u5408\u306F\u30EB\u30FC\u30D7\u3092\u7D42\u4E86\r\n                break;\r\n            }\r\n\r\n            // \u5546\u54C1\u8A73\u7D30\u3092\u53D6\u5F97\r\n            const itemIds = result.response.item.map((i: any) => i.item_id);\r\n            const details = await getItemBaseInfo(partnerId, partnerKey, accessToken, parseInt(shopId), itemIds);\r\n\r\n            if (details.response?.item_list) {\r\n                // Shopee API\u306E\u30EC\u30B9\u30DD\u30F3\u30B9\u3092\u305D\u306E\u307E\u307E\u4FDD\u5B58\r\n                for (const item of details.response.item_list) {\r\n                    allProducts.push(item);\r\n                }\r\n            }\r\n\r\n            hasMore = result.response.has_next_page;\r\n            offset = result.response.next_offset || offset + 50;\r\n        }\r\n\r\n        // 2. D1\u306B\u540C\u671F\uFF08Shopee API\u30D1\u30E9\u30E1\u30FC\u30BF\u3068\u5B8C\u5168\u7D71\u4E00\uFF09\r\n        let synced = 0;\r\n        let failed = 0;\r\n\r\n        for (const item of allProducts) {\r\n            try {\r\n                await env.DB.prepare(`\r\n                    INSERT INTO products (\r\n                        item_id, shop_id, item_name, description, description_type, item_sku,\r\n                        category_id, original_price, current_price, currency, stock,\r\n                        image_url, image_url_list, weight, package_length, package_width, package_height,\r\n                        condition, item_status, sold, views, likes, rating_star, cmt_count,\r\n                        attribute_list, logistic_info, has_model, brand_id,\r\n                        create_time, update_time, last_synced_at\r\n                    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))\r\n                    ON CONFLICT(item_id) DO UPDATE SET\r\n                        item_name = excluded.item_name,\r\n                        description = excluded.description,\r\n                        description_type = excluded.description_type,\r\n                        item_sku = excluded.item_sku,\r\n                        category_id = excluded.category_id,\r\n                        original_price = excluded.original_price,\r\n                        current_price = excluded.current_price,\r\n                        currency = excluded.currency,\r\n                        stock = excluded.stock,\r\n                        image_url = excluded.image_url,\r\n                        image_url_list = excluded.image_url_list,\r\n                        weight = excluded.weight,\r\n                        package_length = excluded.package_length,\r\n                        package_width = excluded.package_width,\r\n                        package_height = excluded.package_height,\r\n                        condition = excluded.condition,\r\n                        item_status = excluded.item_status,\r\n                        sold = excluded.sold,\r\n                        views = excluded.views,\r\n                        likes = excluded.likes,\r\n                        rating_star = excluded.rating_star,\r\n                        cmt_count = excluded.cmt_count,\r\n                        attribute_list = excluded.attribute_list,\r\n                        logistic_info = excluded.logistic_info,\r\n                        has_model = excluded.has_model,\r\n                        brand_id = excluded.brand_id,\r\n                        update_time = excluded.update_time,\r\n                        last_synced_at = datetime('now'),\r\n                        updated_at = datetime('now')\r\n                `).bind(\r\n                    // Shopee API\u30D1\u30E9\u30E1\u30FC\u30BF\u3092\u305D\u306E\u307E\u307E\u4F7F\u7528\r\n                    item.item_id,\r\n                    parseInt(shopId),\r\n                    item.item_name,\r\n                    item.description || null,\r\n                    item.description_type || 'normal',\r\n                    item.item_sku || null,\r\n                    item.category_id || null,\r\n                    item.price_info?.[0]?.original_price || null,\r\n                    item.price_info?.[0]?.current_price || null,\r\n                    item.price_info?.[0]?.currency || 'TWD',\r\n                    item.stock_info_v2?.summary_info?.total_available_stock || 0,\r\n                    item.image?.image_url_list?.[0] || null,\r\n                    JSON.stringify(item.image?.image_url_list || []),\r\n                    item.weight || null,\r\n                    item.dimension?.package_length || null,\r\n                    item.dimension?.package_width || null,\r\n                    item.dimension?.package_height || null,\r\n                    item.condition || 'NEW',\r\n                    item.item_status || 'NORMAL',\r\n                    item.sold || 0,\r\n                    item.views || 0,\r\n                    item.likes || 0,\r\n                    item.rating_star || 0,\r\n                    item.cmt_count || 0,\r\n                    JSON.stringify(item.attribute_list || []),\r\n                    JSON.stringify(item.logistic_info || []),\r\n                    item.has_model ? 1 : 0,\r\n                    item.brand?.brand_id || null,\r\n                    item.create_time || null,\r\n                    item.update_time || null\r\n                ).run();\r\n                synced++;\r\n            } catch (e) {\r\n                console.error(\"Sync error:\", e);\r\n                failed++;\r\n            }\r\n        }\r\n\r\n        // 3. \u540C\u671F\u30ED\u30B0\u3092\u8A18\u9332\r\n        await env.DB.prepare(`\r\n            INSERT INTO sync_logs (shop_id, sync_type, status, items_synced, items_failed, completed_at)\r\n            VALUES (?, 'products', ?, ?, ?, datetime('now'))\r\n        `).bind(parseInt(shopId), failed > 0 ? \"partial\" : \"success\", synced, failed).run();\r\n\r\n        return jsonResponse({\r\n            status: \"success\",\r\n            message: `Synced ${synced} products from Shopee`,\r\n            data: {\r\n                total_fetched: allProducts.length,\r\n                synced,\r\n                failed\r\n            }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Sync error:\", error);\r\n        return errorResponse(`Sync error: ${error}`, 500);\r\n    }\r\n};\r\n\r\n// Shopee API\u547C\u3073\u51FA\u3057\u95A2\u6570\r\nasync function getItemList(partnerId: string, partnerKey: string, accessToken: string, shopId: number, offset = 0): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/product/get_item_list\";\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n    const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}&access_token=${accessToken}&shop_id=${shopId}&offset=${offset}&page_size=50&item_status=NORMAL&item_status=UNLIST`;\r\n    const response = await fetch(apiUrl);\r\n    return await response.json();\r\n}\r\n\r\nasync function getItemBaseInfo(partnerId: string, partnerKey: string, accessToken: string, shopId: number, itemIds: number[]): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/product/get_item_base_info\";\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n    const itemIdList = itemIds.join(\",\");\r\n    const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}&access_token=${accessToken}&shop_id=${shopId}&item_id_list=${itemIdList}`;\r\n    const response = await fetch(apiUrl);\r\n    return await response.json();\r\n}\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const cryptoKey = await crypto.subtle.importKey(\"raw\", encoder.encode(key), { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]);\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, encoder.encode(message));\r\n    return Array.from(new Uint8Array(signature)).map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction jsonResponse(data: any, status = 200): Response {\r\n    return new Response(JSON.stringify(data), { status, headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() } });\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return jsonResponse({ status: \"error\", message }, status);\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return { \"Access-Control-Allow-Origin\": \"*\", \"Access-Control-Allow-Methods\": \"POST, OPTIONS\", \"Access-Control-Allow-Headers\": \"Content-Type\" };\r\n}\r\n", "/**\r\n * D1 Database Tokens API\r\n * \u30C8\u30FC\u30AF\u30F3\u306E\u53D6\u5F97\u30FB\u66F4\u65B0\u30FB\u524A\u9664\r\n */\r\n\r\ninterface Env {\r\n    DB: D1Database;\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    try {\r\n        switch (request.method) {\r\n            case \"GET\":\r\n                return await handleGet(env.DB, url);\r\n            case \"POST\":\r\n                return await handleRefresh(env, url);\r\n            case \"DELETE\":\r\n                return await handleDelete(env.DB, url);\r\n            default:\r\n                return errorResponse(\"Method not allowed\", 405);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Token API error:\", error);\r\n        return errorResponse(`Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\n/**\r\n * GET: \u30C8\u30FC\u30AF\u30F3\u3092\u53D6\u5F97\r\n */\r\nasync function handleGet(db: D1Database, url: URL): Promise<Response> {\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n    if (shopId) {\r\n        // \u7279\u5B9A\u306E\u30B7\u30E7\u30C3\u30D7\u306E\u30C8\u30FC\u30AF\u30F3\u3092\u53D6\u5F97\r\n        const token = await db.prepare(`\r\n            SELECT * FROM tokens WHERE shop_id = ?\r\n        `).bind(parseInt(shopId)).first();\r\n\r\n        if (!token) {\r\n            return jsonResponse({ status: \"error\", message: \"Token not found\", data: null });\r\n        }\r\n\r\n        // \u6709\u52B9\u671F\u9650\u3092\u30C1\u30A7\u30C3\u30AF\r\n        const now = new Date();\r\n        const accessExpires = token.access_token_expires_at ? new Date(token.access_token_expires_at as string) : null;\r\n        const isExpired = accessExpires ? now > accessExpires : true;\r\n\r\n        return jsonResponse({\r\n            status: \"success\",\r\n            data: {\r\n                shop_id: token.shop_id,\r\n                access_token: token.access_token,\r\n                refresh_token: token.refresh_token,\r\n                shop_name: token.shop_name,\r\n                region: token.region,\r\n                access_token_expires_at: token.access_token_expires_at,\r\n                refresh_token_expires_at: token.refresh_token_expires_at,\r\n                is_expired: isExpired,\r\n                updated_at: token.updated_at\r\n            }\r\n        });\r\n    }\r\n\r\n    // \u5168\u30C8\u30FC\u30AF\u30F3\u4E00\u89A7\u3092\u53D6\u5F97\r\n    const tokens = await db.prepare(`\r\n        SELECT shop_id, shop_name, region, access_token_expires_at, updated_at FROM tokens\r\n        ORDER BY updated_at DESC\r\n    `).all();\r\n\r\n    return jsonResponse({\r\n        status: \"success\",\r\n        data: tokens.results\r\n    });\r\n}\r\n\r\n/**\r\n * POST: Refresh Token\u3092\u4F7F\u3063\u3066Access Token\u3092\u66F4\u65B0\r\n */\r\nasync function handleRefresh(env: Env, url: URL): Promise<Response> {\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n    if (!shopId) {\r\n        return errorResponse(\"shop_id required\", 400);\r\n    }\r\n\r\n    // D1\u304B\u3089\u73FE\u5728\u306E\u30C8\u30FC\u30AF\u30F3\u3092\u53D6\u5F97\r\n    const current = await env.DB.prepare(`\r\n        SELECT * FROM tokens WHERE shop_id = ?\r\n    `).bind(parseInt(shopId)).first();\r\n\r\n    if (!current || !current.refresh_token) {\r\n        return errorResponse(\"No refresh token found\", 404);\r\n    }\r\n\r\n    // Shopee API\u3067\u30C8\u30FC\u30AF\u30F3\u3092\u30EA\u30D5\u30EC\u30C3\u30B7\u30E5\r\n    const refreshResult = await refreshAccessToken(\r\n        env.SHOPEE_PARTNER_ID,\r\n        env.SHOPEE_PARTNER_KEY,\r\n        current.refresh_token as string,\r\n        parseInt(shopId)\r\n    );\r\n\r\n    if (refreshResult.error) {\r\n        return jsonResponse({\r\n            status: \"error\",\r\n            message: refreshResult.message || refreshResult.error,\r\n            data: refreshResult\r\n        }, 400);\r\n    }\r\n\r\n    // \u65B0\u3057\u3044\u30C8\u30FC\u30AF\u30F3\u3092D1\u306B\u4FDD\u5B58\r\n    const accessExpires = new Date(Date.now() + (refreshResult.expire_in * 1000)).toISOString();\r\n    const refreshExpires = new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString();\r\n\r\n    await env.DB.prepare(`\r\n        UPDATE tokens SET\r\n            access_token = ?,\r\n            refresh_token = ?,\r\n            access_token_expires_at = ?,\r\n            refresh_token_expires_at = ?,\r\n            updated_at = datetime('now')\r\n        WHERE shop_id = ?\r\n    `).bind(\r\n        refreshResult.access_token,\r\n        refreshResult.refresh_token,\r\n        accessExpires,\r\n        refreshExpires,\r\n        parseInt(shopId)\r\n    ).run();\r\n\r\n    return jsonResponse({\r\n        status: \"success\",\r\n        message: \"Token refreshed and saved to D1\",\r\n        data: {\r\n            access_token: refreshResult.access_token,\r\n            refresh_token: refreshResult.refresh_token,\r\n            expire_in: refreshResult.expire_in,\r\n            access_token_expires_at: accessExpires\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * DELETE: \u30C8\u30FC\u30AF\u30F3\u3092\u524A\u9664\r\n */\r\nasync function handleDelete(db: D1Database, url: URL): Promise<Response> {\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n    if (!shopId) {\r\n        return errorResponse(\"shop_id required\", 400);\r\n    }\r\n\r\n    await db.prepare(`DELETE FROM tokens WHERE shop_id = ?`).bind(parseInt(shopId)).run();\r\n\r\n    return jsonResponse({ status: \"success\", message: \"Token deleted\" });\r\n}\r\n\r\n/**\r\n * Refresh Token\u3092\u4F7F\u3063\u3066Access Token\u3092\u66F4\u65B0\r\n */\r\nasync function refreshAccessToken(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    refreshToken: string,\r\n    shopId: number\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/auth/access_token/get\";\r\n\r\n    const baseString = `${partnerId}${path}${timestamp}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}`;\r\n\r\n    const response = await fetch(apiUrl, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n            refresh_token: refreshToken,\r\n            shop_id: shopId,\r\n            partner_id: parseInt(partnerId)\r\n        })\r\n    });\r\n\r\n    return await response.json();\r\n}\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const cryptoKey = await crypto.subtle.importKey(\"raw\", encoder.encode(key), { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]);\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, encoder.encode(message));\r\n    return Array.from(new Uint8Array(signature)).map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction jsonResponse(data: any, status = 200): Response {\r\n    return new Response(JSON.stringify(data), { status, headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() } });\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return jsonResponse({ status: \"error\", message }, status);\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return { \"Access-Control-Allow-Origin\": \"*\", \"Access-Control-Allow-Methods\": \"GET, POST, DELETE, OPTIONS\", \"Access-Control-Allow-Headers\": \"Content-Type\" };\r\n}\r\n", "/**\r\n * Shopee Add Item API\r\n * \r\n * \u5546\u54C1\u3092Shopee\u306B\u65B0\u898F\u51FA\u54C1\u3057\u307E\u3059\r\n * Endpoint: /api/v2/product/add_item\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    if (request.method !== \"POST\") {\r\n        return errorResponse(\"Method not allowed\", 405);\r\n    }\r\n\r\n    try {\r\n        const body = await request.json() as any;\r\n        const { access_token, shop_id, ...itemData } = body;\r\n\r\n        if (!access_token || !shop_id) {\r\n            return errorResponse(\"access_token and shop_id are required\", 400);\r\n        }\r\n\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        const path = \"/api/v2/product/add_item\";\r\n        const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n        // \u7F72\u540D\u8A08\u7B97\r\n        const baseString = `${partnerId}${path}${timestamp}${access_token}${shop_id}`;\r\n        const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n        const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&access_token=${access_token}&shop_id=${shop_id}&sign=${sign}`;\r\n\r\n        // Shopee API\u3078\u306E\u30EA\u30AF\u30A8\u30B9\u30C8\u30C7\u30FC\u30BF\u69CB\u7BC9\r\n        // \u5FC5\u9808\u9805\u76EE: original_price, description, item_name, item_status, normal_stock, category_id, image, weight, logistic_info\r\n\r\n        const payload = {\r\n            original_price: itemData.original_price,\r\n            description: itemData.description,\r\n            item_name: itemData.item_name,\r\n            item_status: \"NORMAL\", // \u51FA\u54C1\u4E2D\r\n            normal_stock: itemData.normal_stock,\r\n            category_id: itemData.category_id,\r\n            image: itemData.image, // { image_id_list: string[] }\r\n            weight: itemData.weight || 0.5,\r\n            logistic_info: itemData.logistic_info || [], // \u9001\u6599\u8A2D\u5B9A\r\n            attribute_list: itemData.attribute_list || [],\r\n            ...itemData\r\n        };\r\n\r\n        const response = await fetch(apiUrl, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(payload)\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        return new Response(JSON.stringify(data), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Add Item error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\", keyData, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee Attributes API\r\n * \r\n * \u30AB\u30C6\u30B4\u30EA\u3054\u3068\u306E\u5C5E\u6027\u60C5\u5831\u3092\u53D6\u5F97\u3057\u307E\u3059\uFF08\u30D6\u30E9\u30F3\u30C9\u306A\u3069\uFF09\r\n * Endpoint: /api/v2/product/get_attributes\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    try {\r\n        const url = new URL(request.url);\r\n        const accessToken = url.searchParams.get(\"access_token\");\r\n        const shopId = url.searchParams.get(\"shop_id\");\r\n        const categoryId = url.searchParams.get(\"category_id\");\r\n        const language = url.searchParams.get(\"language\") || \"zh-Hant\"; // \u30C7\u30D5\u30A9\u30EB\u30C8\u7E41\u4F53\u5B57\r\n\r\n        if (!accessToken || !shopId || !categoryId) {\r\n            return errorResponse(\"access_token, shop_id, and category_id are required\", 400);\r\n        }\r\n\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        const path = \"/api/v2/product/get_attributes\";\r\n        const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n        // \u7F72\u540D\u8A08\u7B97\r\n        const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n        const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n        // \u30AF\u30A8\u30EA\u30D1\u30E9\u30E1\u30FC\u30BF\r\n        const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&access_token=${accessToken}&shop_id=${shopId}&sign=${sign}&category_id=${categoryId}&language=${language}`;\r\n\r\n        const response = await fetch(apiUrl, {\r\n            method: \"GET\",\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        return new Response(JSON.stringify(data), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Attributes API error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\", keyData, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee OAuth\u8A8D\u53EFURL\u751F\u6210\u30A8\u30F3\u30C9\u30DD\u30A4\u30F3\u30C8\r\n * \r\n * \u53F0\u6E7E\u30B7\u30E7\u30C3\u30D7\u3068\u306E\u9023\u643A\u3092\u958B\u59CB\u3059\u308B\u305F\u3081\u306E\u8A8D\u53EFURL\u3092\u751F\u6210\u3057\u307E\u3059\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\n// Shopee API\u8A2D\u5B9A\uFF08\u53F0\u6E7E\uFF09\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\nconst REDIRECT_URL = \"https://shopee-automate.pages.dev/api/callback\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, {\r\n            status: 204,\r\n            headers: getCorsHeaders(),\r\n        });\r\n    }\r\n\r\n    try {\r\n        const partnerId = parseInt(env.SHOPEE_PARTNER_ID);\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        if (!partnerId || !partnerKey) {\r\n            return errorResponse(\"\u74B0\u5883\u5909\u6570\u304C\u8A2D\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093\", 500);\r\n        }\r\n\r\n        // \u30BF\u30A4\u30E0\u30B9\u30BF\u30F3\u30D7\uFF08\u79D2\uFF09\r\n        const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n        // \u7F72\u540D\u8A08\u7B97: partner_id + path + timestamp\r\n        const path = \"/api/v2/shop/auth_partner\";\r\n        const baseString = `${partnerId}${path}${timestamp}`;\r\n        const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n        // \u8A8D\u53EFURL\u751F\u6210\r\n        const authUrl = new URL(`${SHOPEE_HOST}${path}`);\r\n        authUrl.searchParams.set(\"partner_id\", partnerId.toString());\r\n        authUrl.searchParams.set(\"timestamp\", timestamp.toString());\r\n        authUrl.searchParams.set(\"sign\", sign);\r\n        authUrl.searchParams.set(\"redirect\", REDIRECT_URL);\r\n\r\n        return new Response(JSON.stringify({\r\n            status: \"success\",\r\n            message: \"\u8A8D\u53EFURL\u3092\u751F\u6210\u3057\u307E\u3057\u305F\u3002\u4EE5\u4E0B\u306EURL\u306B\u30A2\u30AF\u30BB\u30B9\u3057\u3066\u30B7\u30E7\u30C3\u30D7\u3092\u8A8D\u53EF\u3057\u3066\u304F\u3060\u3055\u3044\u3002\",\r\n            auth_url: authUrl.toString(),\r\n            partner_id: partnerId,\r\n            timestamp: timestamp,\r\n        }), {\r\n            status: 200,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                ...getCorsHeaders(),\r\n            },\r\n        });\r\n\r\n    } catch (error) {\r\n        return errorResponse(`\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: ${error}`, 500);\r\n    }\r\n};\r\n\r\n/**\r\n * HMAC-SHA256\u7F72\u540D\u3092\u751F\u6210\r\n */\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        keyData,\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee Category API\r\n * \r\n * Shopee\u306E\u30AB\u30C6\u30B4\u30EA\u30FC\u4E00\u89A7\u3092\u53D6\u5F97\u3057\u307E\u3059\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    try {\r\n        const url = new URL(request.url);\r\n        const accessToken = url.searchParams.get(\"access_token\");\r\n        const shopId = url.searchParams.get(\"shop_id\");\r\n        const language = url.searchParams.get(\"language\") || \"ja\"; // \u30C7\u30D5\u30A9\u30EB\u30C8\u65E5\u672C\u8A9E\r\n\r\n        if (!accessToken || !shopId) {\r\n            return errorResponse(\"access_token and shop_id are required\", 400);\r\n        }\r\n\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        const path = \"/api/v2/product/get_category\";\r\n        const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n        // \u7F72\u540D\u8A08\u7B97\r\n        const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n        const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n        const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&access_token=${accessToken}&shop_id=${shopId}&sign=${sign}&language=${language}`;\r\n\r\n        const response = await fetch(apiUrl);\r\n        const data = await response.json();\r\n\r\n        return new Response(JSON.stringify(data), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Category fetch error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\", keyData, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee OAuth\u8A8D\u53EF\u30B3\u30FC\u30C9\u4EA4\u63DB\u30A8\u30F3\u30C9\u30DD\u30A4\u30F3\u30C8\r\n * \r\n * \u30D5\u30ED\u30F3\u30C8\u30A8\u30F3\u30C9\u304B\u3089\u8A8D\u53EF\u30B3\u30FC\u30C9\u3092\u53D7\u3051\u53D6\u308A\u3001Access Token\u306B\u4EA4\u63DB\u3057\u3066D1\u306B\u4FDD\u5B58\u3057\u307E\u3059\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n    DB: D1Database;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, {\r\n            status: 204,\r\n            headers: getCorsHeaders(),\r\n        });\r\n    }\r\n\r\n    if (request.method !== \"POST\") {\r\n        return errorResponse(\"Method not allowed\", 405);\r\n    }\r\n\r\n    try {\r\n        const body = await request.json() as { code: string, shop_id: number };\r\n        const { code, shop_id } = body;\r\n\r\n        if (!code || !shop_id) {\r\n            return errorResponse(\"code and shop_id are required\", 400);\r\n        }\r\n\r\n        // \u30A2\u30AF\u30BB\u30B9\u30C8\u30FC\u30AF\u30F3\u3092\u53D6\u5F97\r\n        const tokenResult = await getAccessToken(\r\n            env.SHOPEE_PARTNER_ID,\r\n            env.SHOPEE_PARTNER_KEY,\r\n            code,\r\n            shop_id\r\n        );\r\n\r\n        if (tokenResult.error) {\r\n            return errorResponse(`Shopee API Error: ${tokenResult.error} - ${tokenResult.message || ''}`, 400);\r\n        }\r\n\r\n        // D1\u306B\u4FDD\u5B58\r\n        await saveTokenToD1(env.DB, {\r\n            shop_id: shop_id,\r\n            access_token: tokenResult.access_token,\r\n            refresh_token: tokenResult.refresh_token,\r\n            expire_in: tokenResult.expire_in,\r\n            shop_name: null // \u5F8C\u3067\u53D6\u5F97\u53EF\u80FD\r\n        });\r\n\r\n        return new Response(JSON.stringify({\r\n            status: \"success\",\r\n            message: \"Authentication successful\",\r\n            data: {\r\n                shop_id: shop_id,\r\n                access_token: tokenResult.access_token,\r\n                refresh_token: tokenResult.refresh_token,\r\n                expires_in: tokenResult.expire_in\r\n            }\r\n        }), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Auth exchange error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\n/**\r\n * \u30C8\u30FC\u30AF\u30F3\u3092D1\u306B\u4FDD\u5B58\r\n */\r\nasync function saveTokenToD1(db: D1Database, data: {\r\n    shop_id: number;\r\n    access_token: string;\r\n    refresh_token: string;\r\n    expire_in: number;\r\n    shop_name: string | null;\r\n}): Promise<void> {\r\n    const accessExpires = new Date(Date.now() + (data.expire_in * 1000)).toISOString();\r\n    const refreshExpires = new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString(); // 30\u65E5\r\n\r\n    await db.prepare(`\r\n        INSERT INTO tokens (shop_id, access_token, refresh_token, access_token_expires_at, refresh_token_expires_at, shop_name, region)\r\n        VALUES (?, ?, ?, ?, ?, ?, 'TW')\r\n        ON CONFLICT(shop_id) DO UPDATE SET\r\n            access_token = excluded.access_token,\r\n            refresh_token = excluded.refresh_token,\r\n            access_token_expires_at = excluded.access_token_expires_at,\r\n            refresh_token_expires_at = excluded.refresh_token_expires_at,\r\n            updated_at = datetime('now')\r\n    `).bind(\r\n        data.shop_id,\r\n        data.access_token,\r\n        data.refresh_token,\r\n        accessExpires,\r\n        refreshExpires,\r\n        data.shop_name\r\n    ).run();\r\n}\r\n\r\n/**\r\n * \u8A8D\u53EF\u30B3\u30FC\u30C9\u304B\u3089Access Token\u3092\u53D6\u5F97\r\n */\r\nasync function getAccessToken(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    code: string,\r\n    shopId: number\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/auth/token/get\";\r\n\r\n    // \u7F72\u540D\u8A08\u7B97\r\n    const baseString = `${partnerId}${path}${timestamp}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    const tokenUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}`;\r\n\r\n    const response = await fetch(tokenUrl, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n            code: code,\r\n            shop_id: parseInt(shopId.toString()),\r\n            partner_id: parseInt(partnerId),\r\n        }),\r\n    });\r\n\r\n    return await response.json();\r\n}\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        keyData,\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee Product Detail API\r\n * \r\n * \u5546\u54C1\u306E\u8A73\u7D30\u60C5\u5831\uFF08Base Info\uFF09\u3092\u53D6\u5F97\u3057\u307E\u3059\r\n * Endpoint: /api/v2/product/get_item_base_info\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    try {\r\n        const url = new URL(request.url);\r\n        const accessToken = url.searchParams.get(\"access_token\");\r\n        const shopId = url.searchParams.get(\"shop_id\");\r\n        const itemId = url.searchParams.get(\"item_id\");\r\n\r\n        if (!accessToken || !shopId || !itemId) {\r\n            return errorResponse(\"access_token, shop_id, and item_id are required\", 400);\r\n        }\r\n\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        const path = \"/api/v2/product/get_item_base_info\";\r\n        const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n        // \u7F72\u540D\u8A08\u7B97\r\n        const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n        const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n        // \u30AF\u30A8\u30EA\u30D1\u30E9\u30E1\u30FC\u30BF\u3068\u3057\u3066 item_id_list \u3092\u6E21\u3059 (V2 API\u4ED5\u69D8\u78BA\u8A8D: GET\u306E\u5834\u5408\u306FURL\u30D1\u30E9\u30E1\u30FC\u30BF)\r\n        // \u6CE8\u610F: V2\u306Eget_item_base_info\u306FGET\u30E1\u30BD\u30C3\u30C9\u3067\u3001item_id_list\u3092\u53D7\u3051\u53D6\u308B\r\n        // item_id=123,456 \u306E\u3088\u3046\u306B\u30AB\u30F3\u30DE\u533A\u5207\u308A\u3001\u307E\u305F\u306F &item_id_list=123&item_id_list=456\r\n        // Shopee V2 API\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u306B\u3088\u308B\u3068: item_id_list=12345\r\n\r\n        const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&access_token=${accessToken}&shop_id=${shopId}&sign=${sign}&item_id_list=${itemId}`;\r\n\r\n        const response = await fetch(apiUrl, {\r\n            method: \"GET\",\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        return new Response(JSON.stringify(data), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Item Detail error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\", keyData, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee Logistics API\r\n * \r\n * \u7269\u6D41\u30C1\u30E3\u30F3\u30CD\u30EB\u4E00\u89A7\u3092\u53D6\u5F97\u3057\u307E\u3059\r\n * Endpoint: /api/v2/logistics/get_channel_list\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    try {\r\n        const url = new URL(request.url);\r\n        const accessToken = url.searchParams.get(\"access_token\");\r\n        const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n        if (!accessToken || !shopId) {\r\n            return errorResponse(\"access_token and shop_id are required\", 400);\r\n        }\r\n\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        const path = \"/api/v2/logistics/get_channel_list\";\r\n        const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n        // \u7F72\u540D\u8A08\u7B97\r\n        const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n        const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n        const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&access_token=${accessToken}&shop_id=${shopId}&sign=${sign}`;\r\n\r\n        const response = await fetch(apiUrl, {\r\n            method: \"GET\",\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        return new Response(JSON.stringify(data), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Logistics error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\", keyData, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee \u6CE8\u6587\u4E00\u89A7\u53D6\u5F97\u30A8\u30F3\u30C9\u30DD\u30A4\u30F3\u30C8\r\n * \r\n * /api/v2/order/get_order_list \u3092\u4F7F\u7528\u3057\u3066\u6CE8\u6587\u4E00\u89A7\u3092\u53D6\u5F97\r\n * /api/v2/order/get_order_detail \u3067\u8A73\u7D30\u60C5\u5831\u3092\u53D6\u5F97\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, {\r\n            status: 204,\r\n            headers: getCorsHeaders(),\r\n        });\r\n    }\r\n\r\n    // \u30AF\u30A8\u30EA\u30D1\u30E9\u30E1\u30FC\u30BF\u304B\u3089\u30C8\u30FC\u30AF\u30F3\u3068\u30B7\u30E7\u30C3\u30D7ID\u3092\u53D6\u5F97\r\n    const accessToken = url.searchParams.get(\"access_token\");\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n    const orderStatus = url.searchParams.get(\"order_status\") || \"READY_TO_SHIP\";\r\n    const pageSize = parseInt(url.searchParams.get(\"page_size\") || \"20\");\r\n    const cursor = url.searchParams.get(\"cursor\") || \"\";\r\n\r\n    if (!accessToken || !shopId) {\r\n        return new Response(JSON.stringify({\r\n            status: \"error\",\r\n            message: \"access_token \u3068 shop_id \u30D1\u30E9\u30E1\u30FC\u30BF\u304C\u5FC5\u8981\u3067\u3059\"\r\n        }), {\r\n            status: 400,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n    }\r\n\r\n    try {\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        if (!partnerId || !partnerKey) {\r\n            throw new Error(\"\u74B0\u5883\u5909\u6570\u304C\u8A2D\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093\");\r\n        }\r\n\r\n        // \u904E\u53BB15\u65E5\u9593\u306E\u6CE8\u6587\u3092\u53D6\u5F97\uFF08Shopee API\u306F\u6700\u592715\u65E5\u9593\u306E\u5236\u9650\uFF09\r\n        const timeFrom = Math.floor(Date.now() / 1000) - (15 * 24 * 60 * 60);\r\n        const timeTo = Math.floor(Date.now() / 1000);\r\n\r\n        // \u6CE8\u6587\u4E00\u89A7\u3092\u53D6\u5F97\r\n        const orderList = await getOrderList(\r\n            partnerId,\r\n            partnerKey,\r\n            accessToken,\r\n            parseInt(shopId),\r\n            timeFrom,\r\n            timeTo,\r\n            orderStatus,\r\n            pageSize,\r\n            cursor\r\n        );\r\n\r\n        if (orderList.error) {\r\n            return new Response(JSON.stringify({\r\n                status: \"error\",\r\n                message: orderList.message || orderList.error,\r\n                data: orderList\r\n            }), {\r\n                status: 400,\r\n                headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n            });\r\n        }\r\n\r\n        // \u6CE8\u6587\u8A73\u7D30\u60C5\u5831\u3092\u53D6\u5F97\r\n        let orders = [];\r\n        if (orderList.response?.order_list && orderList.response.order_list.length > 0) {\r\n            const orderSns = orderList.response.order_list.map((order: any) => order.order_sn);\r\n            const orderDetails = await getOrderDetail(\r\n                partnerId,\r\n                partnerKey,\r\n                accessToken,\r\n                parseInt(shopId),\r\n                orderSns\r\n            );\r\n\r\n            if (orderDetails.response?.order_list) {\r\n                orders = orderDetails.response.order_list.map((order: any) => {\r\n                    // \u91D1\u984D\u3092\u8A08\u7B97\uFF08\u8907\u6570\u306E\u30BD\u30FC\u30B9\u304B\u3089\u30D5\u30A9\u30FC\u30EB\u30D0\u30C3\u30AF\uFF09\r\n                    let totalAmount = 0;\r\n                    if (order.total_amount !== undefined && order.total_amount !== null) {\r\n                        totalAmount = parseFloat(order.total_amount) || 0;\r\n                    } else if (order.escrow_amount !== undefined) {\r\n                        totalAmount = parseFloat(order.escrow_amount) || 0;\r\n                    } else if (order.item_list && order.item_list.length > 0) {\r\n                        // \u30A2\u30A4\u30C6\u30E0\u304B\u3089\u5408\u8A08\u3092\u8A08\u7B97\r\n                        totalAmount = order.item_list.reduce((sum: number, item: any) => {\r\n                            const price = parseFloat(item.model_discounted_price) || parseFloat(item.model_original_price) || 0;\r\n                            const qty = parseInt(item.model_quantity_purchased) || 1;\r\n                            return sum + (price * qty);\r\n                        }, 0);\r\n                    }\r\n\r\n                    return {\r\n                        id: order.order_sn,\r\n                        customer: order.buyer_username || \"\u533F\u540D\u30E6\u30FC\u30B6\u30FC\",\r\n                        buyer_user_id: order.buyer_user_id,\r\n                        items: order.item_list?.length || 0,\r\n                        item_list: order.item_list?.map((item: any) => ({\r\n                            name: item.item_name,\r\n                            sku: item.item_sku,\r\n                            quantity: item.model_quantity_purchased,\r\n                            price: parseFloat(item.model_discounted_price) || parseFloat(item.model_original_price) || 0,\r\n                            image: item.image_info?.image_url\r\n                        })) || [],\r\n                        total: totalAmount,\r\n                        currency: order.currency || \"TWD\",\r\n                        status: mapOrderStatus(order.order_status),\r\n                        order_status: order.order_status,\r\n                        date: formatTimestamp(order.create_time),\r\n                        create_time: order.create_time,\r\n                        update_time: order.update_time,\r\n                        shipping: {\r\n                            carrier: order.shipping_carrier,\r\n                            tracking_number: order.tracking_number,\r\n                            recipient_address: order.recipient_address\r\n                        },\r\n                        payment_method: order.payment_method,\r\n                        note: order.note || \"\",\r\n                        message_to_seller: order.message_to_seller || \"\"\r\n                    };\r\n                });\r\n            }\r\n        }\r\n\r\n        return new Response(JSON.stringify({\r\n            status: \"success\",\r\n            message: \"\u6CE8\u6587\u4E00\u89A7\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\",\r\n            data: {\r\n                orders: orders,\r\n                more: orderList.response?.more || false,\r\n                next_cursor: orderList.response?.next_cursor || null,\r\n            }\r\n        }), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        return new Response(JSON.stringify({\r\n            status: \"error\",\r\n            message: `\u30A8\u30E9\u30FC: ${error}`,\r\n        }), {\r\n            status: 500,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * \u6CE8\u6587\u4E00\u89A7\u3092\u53D6\u5F97\r\n */\r\nasync function getOrderList(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    accessToken: string,\r\n    shopId: number,\r\n    timeFrom: number,\r\n    timeTo: number,\r\n    orderStatus: string,\r\n    pageSize: number,\r\n    cursor: string\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/order/get_order_list\";\r\n\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    let apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}&access_token=${accessToken}&shop_id=${shopId}&time_range_field=create_time&time_from=${timeFrom}&time_to=${timeTo}&page_size=${pageSize}`;\r\n\r\n    if (orderStatus && orderStatus !== \"ALL\") {\r\n        apiUrl += `&order_status=${orderStatus}`;\r\n    }\r\n    if (cursor) {\r\n        apiUrl += `&cursor=${cursor}`;\r\n    }\r\n\r\n    const response = await fetch(apiUrl, {\r\n        method: \"GET\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n\r\n    return await response.json();\r\n}\r\n\r\n/**\r\n * \u6CE8\u6587\u8A73\u7D30\u3092\u53D6\u5F97\r\n */\r\nasync function getOrderDetail(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    accessToken: string,\r\n    shopId: number,\r\n    orderSns: string[]\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/order/get_order_detail\";\r\n\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    const orderSnList = orderSns.join(\",\");\r\n    const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}&access_token=${accessToken}&shop_id=${shopId}&order_sn_list=${orderSnList}&response_optional_fields=buyer_username,item_list,recipient_address,note,message_to_seller`;\r\n\r\n    const response = await fetch(apiUrl, {\r\n        method: \"GET\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n\r\n    return await response.json();\r\n}\r\n\r\n/**\r\n * Shopee\u6CE8\u6587\u30B9\u30C6\u30FC\u30BF\u30B9\u3092\u30A2\u30D7\u30EA\u5185\u30B9\u30C6\u30FC\u30BF\u30B9\u306B\u30DE\u30C3\u30D4\u30F3\u30B0\r\n */\r\nfunction mapOrderStatus(status: string): string {\r\n    const statusMap: Record<string, string> = {\r\n        \"UNPAID\": \"pending\",\r\n        \"READY_TO_SHIP\": \"processing\",\r\n        \"PROCESSED\": \"processing\",\r\n        \"SHIPPED\": \"shipped\",\r\n        \"COMPLETED\": \"delivered\",\r\n        \"IN_CANCEL\": \"cancelled\",\r\n        \"CANCELLED\": \"cancelled\",\r\n        \"INVOICE_PENDING\": \"pending\"\r\n    };\r\n    return statusMap[status] || \"pending\";\r\n}\r\n\r\n/**\r\n * \u30BF\u30A4\u30E0\u30B9\u30BF\u30F3\u30D7\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\r\n */\r\nfunction formatTimestamp(timestamp: number): string {\r\n    const date = new Date(timestamp * 1000);\r\n    return date.toLocaleString(\"ja-JP\", {\r\n        year: \"numeric\",\r\n        month: \"2-digit\",\r\n        day: \"2-digit\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\"\r\n    }).replace(/\\//g, \"-\");\r\n}\r\n\r\n/**\r\n * HMAC-SHA256\u7F72\u540D\u3092\u751F\u6210\r\n */\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        keyData,\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n", "/**\r\n * Shopee \u5546\u54C1\u4E00\u89A7\u53D6\u5F97\u30A8\u30F3\u30C9\u30DD\u30A4\u30F3\u30C8\r\n * \r\n * /api/v2/product/get_item_list \u3092\u4F7F\u7528\u3057\u3066\u5546\u54C1\u4E00\u89A7\u3092\u53D6\u5F97\r\n * /api/v2/product/get_item_base_info \u3067\u8A73\u7D30\u60C5\u5831\u3092\u53D6\u5F97\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, {\r\n            status: 204,\r\n            headers: getCorsHeaders(),\r\n        });\r\n    }\r\n\r\n    // \u30AF\u30A8\u30EA\u30D1\u30E9\u30E1\u30FC\u30BF\u304B\u3089\u30C8\u30FC\u30AF\u30F3\u3068\u30B7\u30E7\u30C3\u30D7ID\u3092\u53D6\u5F97\r\n    const accessToken = url.searchParams.get(\"access_token\");\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n    const offset = parseInt(url.searchParams.get(\"offset\") || \"0\");\r\n    const pageSize = parseInt(url.searchParams.get(\"page_size\") || \"20\");\r\n    const itemId = url.searchParams.get(\"item_id\"); // \u500B\u5225\u5546\u54C1\u53D6\u5F97\u7528\r\n\r\n    if (!accessToken || !shopId) {\r\n        return new Response(JSON.stringify({\r\n            status: \"error\",\r\n            message: \"access_token \u3068 shop_id \u30D1\u30E9\u30E1\u30FC\u30BF\u304C\u5FC5\u8981\u3067\u3059\"\r\n        }), {\r\n            status: 400,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n    }\r\n\r\n    try {\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        if (!partnerId || !partnerKey) {\r\n            throw new Error(\"\u74B0\u5883\u5909\u6570\u304C\u8A2D\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093\");\r\n        }\r\n\r\n        // item_id\u304C\u6307\u5B9A\u3055\u308C\u305F\u5834\u5408\u306F\u500B\u5225\u5546\u54C1\u3092\u53D6\u5F97\r\n        if (itemId) {\r\n            const itemInfo = await getItemBaseInfo(\r\n                partnerId,\r\n                partnerKey,\r\n                accessToken,\r\n                parseInt(shopId),\r\n                [parseInt(itemId)]\r\n            );\r\n\r\n            if (itemInfo.error) {\r\n                return new Response(JSON.stringify({\r\n                    status: \"error\",\r\n                    message: itemInfo.message || itemInfo.error,\r\n                    data: itemInfo\r\n                }), {\r\n                    status: 400,\r\n                    headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n                });\r\n            }\r\n\r\n            let products = [];\r\n            if (itemInfo.response?.item_list && itemInfo.response.item_list.length > 0) {\r\n                products = itemInfo.response.item_list.map((item: any) => ({\r\n                    id: item.item_id,\r\n                    item_id: item.item_id,\r\n                    name: item.item_name,\r\n                    description: item.description || \"\",\r\n                    price: item.price_info?.[0]?.current_price || 0,\r\n                    originalPrice: item.price_info?.[0]?.original_price || 0,\r\n                    currency: item.price_info?.[0]?.currency || \"TWD\",\r\n                    stock: item.stock_info_v2?.summary_info?.total_available_stock || 0,\r\n                    status: mapItemStatus(item.item_status),\r\n                    image: item.image?.image_url_list?.[0] || null,\r\n                    images: item.image?.image_url_list || [],\r\n                    category_id: item.category_id,\r\n                    sold: item.sold || 0,\r\n                    views: item.views || 0,\r\n                    likes: item.likes || 0,\r\n                    rating_star: item.rating_star || 0,\r\n                    create_time: item.create_time,\r\n                    update_time: item.update_time,\r\n                }));\r\n            }\r\n\r\n            return new Response(JSON.stringify({\r\n                status: \"success\",\r\n                message: \"\u5546\u54C1\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\",\r\n                data: {\r\n                    products: products,\r\n                    total: products.length,\r\n                }\r\n            }), {\r\n                status: 200,\r\n                headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n            });\r\n        }\r\n\r\n        // \u5546\u54C1\u4E00\u89A7\u3092\u53D6\u5F97\r\n        const itemList = await getItemList(\r\n            partnerId,\r\n            partnerKey,\r\n            accessToken,\r\n            parseInt(shopId),\r\n            offset,\r\n            pageSize\r\n        );\r\n\r\n        if (itemList.error) {\r\n            return new Response(JSON.stringify({\r\n                status: \"error\",\r\n                message: itemList.message || itemList.error,\r\n                data: itemList\r\n            }), {\r\n                status: 400,\r\n                headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n            });\r\n        }\r\n\r\n        // \u5546\u54C1\u8A73\u7D30\u60C5\u5831\u3092\u53D6\u5F97\uFF08\u30A2\u30A4\u30C6\u30E0\u304C\u3042\u308B\u5834\u5408\uFF09\r\n        let products = [];\r\n        if (itemList.response?.item && itemList.response.item.length > 0) {\r\n            const itemIds = itemList.response.item.map((item: any) => item.item_id);\r\n            const itemInfo = await getItemBaseInfo(\r\n                partnerId,\r\n                partnerKey,\r\n                accessToken,\r\n                parseInt(shopId),\r\n                itemIds\r\n            );\r\n\r\n            if (itemInfo.response?.item_list) {\r\n                products = itemInfo.response.item_list.map((item: any) => ({\r\n                    id: item.item_id,\r\n                    item_id: item.item_id,\r\n                    name: item.item_name,\r\n                    description: item.description,\r\n                    price: item.price_info?.[0]?.current_price || 0,\r\n                    originalPrice: item.price_info?.[0]?.original_price || 0,\r\n                    currency: item.price_info?.[0]?.currency || \"TWD\",\r\n                    stock: item.stock_info_v2?.summary_info?.total_available_stock || 0,\r\n                    status: mapItemStatus(item.item_status),\r\n                    image: item.image?.image_url_list?.[0] || null,\r\n                    images: item.image?.image_url_list || [],\r\n                    category_id: item.category_id,\r\n                    sold: item.sold || 0,\r\n                    views: item.views || 0,\r\n                    likes: item.likes || 0,\r\n                    rating_star: item.rating_star || 0,\r\n                    create_time: item.create_time,\r\n                    update_time: item.update_time,\r\n                }));\r\n            }\r\n        }\r\n\r\n        return new Response(JSON.stringify({\r\n            status: \"success\",\r\n            message: \"\u5546\u54C1\u4E00\u89A7\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\",\r\n            data: {\r\n                products: products,\r\n                total: itemList.response?.total_count || 0,\r\n                has_next_page: itemList.response?.has_next_page || false,\r\n                next_offset: itemList.response?.next_offset || null,\r\n            }\r\n        }), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        return new Response(JSON.stringify({\r\n            status: \"error\",\r\n            message: `\u30A8\u30E9\u30FC: ${error}`,\r\n        }), {\r\n            status: 500,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * \u5546\u54C1\u4E00\u89A7\u3092\u53D6\u5F97\r\n */\r\nasync function getItemList(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    accessToken: string,\r\n    shopId: number,\r\n    offset: number,\r\n    pageSize: number\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/product/get_item_list\";\r\n\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    // \u8907\u6570\u306E\u30B9\u30C6\u30FC\u30BF\u30B9\u3092\u6307\u5B9A\uFF08\u5728\u5EAB0\u306E\u5546\u54C1\u3082\u542B\u3080\uFF09\r\n    const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}&access_token=${accessToken}&shop_id=${shopId}&offset=${offset}&page_size=${pageSize}&item_status=NORMAL&item_status=UNLIST`;\r\n\r\n    const response = await fetch(apiUrl, {\r\n        method: \"GET\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n\r\n    return await response.json();\r\n}\r\n\r\n/**\r\n * \u5546\u54C1\u8A73\u7D30\u60C5\u5831\u3092\u53D6\u5F97\r\n */\r\nasync function getItemBaseInfo(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    accessToken: string,\r\n    shopId: number,\r\n    itemIds: number[]\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/product/get_item_base_info\";\r\n\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    const itemIdList = itemIds.join(\",\");\r\n    // need_description\u3092\u8FFD\u52A0\u3057\u3066Description\u3092\u53D6\u5F97\u53EF\u80FD\u306B\r\n    const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}&access_token=${accessToken}&shop_id=${shopId}&item_id_list=${itemIdList}&need_tax_info=false&need_complaint_policy=false`;\r\n\r\n    const response = await fetch(apiUrl, {\r\n        method: \"GET\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n\r\n    return await response.json();\r\n}\r\n\r\n/**\r\n * Shopee\u30B9\u30C6\u30FC\u30BF\u30B9\u3092\u30A2\u30D7\u30EA\u5185\u30B9\u30C6\u30FC\u30BF\u30B9\u306B\u30DE\u30C3\u30D4\u30F3\u30B0\r\n */\r\nfunction mapItemStatus(status: string): string {\r\n    const statusMap: Record<string, string> = {\r\n        \"NORMAL\": \"active\",\r\n        \"UNLIST\": \"inactive\",\r\n        \"BANNED\": \"banned\",\r\n        \"DELETED\": \"deleted\"\r\n    };\r\n    return statusMap[status] || \"unknown\";\r\n}\r\n\r\n/**\r\n * HMAC-SHA256\u7F72\u540D\u3092\u751F\u6210\r\n */\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        keyData,\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n", "/**\r\n * Shopee \u63A5\u7D9A\u30C6\u30B9\u30C8\u30A8\u30F3\u30C9\u30DD\u30A4\u30F3\u30C8\r\n * \r\n * Access Token\u3092\u4F7F\u7528\u3057\u3066\u30B7\u30E7\u30C3\u30D7\u60C5\u5831\u3092\u53D6\u5F97\u3057\u3001\r\n * \u53F0\u6E7EShopee\u3068\u306E\u63A5\u7D9A\u304C\u6B63\u5E38\u304B\u3069\u3046\u304B\u3092\u30C6\u30B9\u30C8\u3057\u307E\u3059\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { env, request } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, {\r\n            status: 204,\r\n            headers: getCorsHeaders(),\r\n        });\r\n    }\r\n\r\n    // \u30AF\u30A8\u30EA\u30D1\u30E9\u30E1\u30FC\u30BF\u304B\u3089\u30C8\u30FC\u30AF\u30F3\u3068\u30B7\u30E7\u30C3\u30D7ID\u3092\u53D6\u5F97\r\n    const accessToken = url.searchParams.get(\"access_token\");\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n    if (!accessToken || !shopId) {\r\n        return new Response(JSON.stringify({\r\n            status: \"error\",\r\n            message: \"access_token \u3068 shop_id \u30D1\u30E9\u30E1\u30FC\u30BF\u304C\u5FC5\u8981\u3067\u3059\",\r\n            usage: \"/api/shopee/test-connection?access_token=YOUR_TOKEN&shop_id=YOUR_SHOP_ID\"\r\n        }), {\r\n            status: 400,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n    }\r\n\r\n    try {\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        if (!partnerId || !partnerKey) {\r\n            throw new Error(\"\u74B0\u5883\u5909\u6570\u304C\u8A2D\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093\");\r\n        }\r\n\r\n        // Shop Info API\u3092\u547C\u3073\u51FA\u3057\r\n        const shopInfo = await getShopInfo(\r\n            partnerId,\r\n            partnerKey,\r\n            accessToken,\r\n            parseInt(shopId)\r\n        );\r\n\r\n        const isSuccess = !shopInfo.error;\r\n\r\n        return new Response(JSON.stringify({\r\n            status: isSuccess ? \"success\" : \"error\",\r\n            message: isSuccess ? \"\u53F0\u6E7EShopee\u30B7\u30E7\u30C3\u30D7\u3068\u306E\u63A5\u7D9A\u304C\u78BA\u8A8D\u3067\u304D\u307E\u3057\u305F\uFF01\" : \"\u63A5\u7D9A\u30A8\u30E9\u30FC\",\r\n            shop_info: shopInfo,\r\n            tested_at: new Date().toISOString(),\r\n        }), {\r\n            status: isSuccess ? 200 : 400,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        return new Response(JSON.stringify({\r\n            status: \"error\",\r\n            message: `\u30C6\u30B9\u30C8\u5931\u6557: ${error}`,\r\n        }), {\r\n            status: 500,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n    }\r\n};\r\n\r\n/**\r\n * \u30B7\u30E7\u30C3\u30D7\u60C5\u5831\u3092\u53D6\u5F97\r\n */\r\nasync function getShopInfo(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    accessToken: string,\r\n    shopId: number\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/shop/get_shop_info\";\r\n\r\n    // \u7F72\u540D\u8A08\u7B97: partner_id + path + timestamp + access_token + shop_id\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}&access_token=${accessToken}&shop_id=${shopId}`;\r\n\r\n    console.log(\"Calling Shop Info API:\", apiUrl.replace(accessToken, \"***\"));\r\n\r\n    const response = await fetch(apiUrl, {\r\n        method: \"GET\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n        },\r\n    });\r\n\r\n    const result = await response.json();\r\n    console.log(\"Shop Info Result:\", JSON.stringify(result, null, 2));\r\n    return result;\r\n}\r\n\r\n/**\r\n * HMAC-SHA256\u7F72\u540D\u3092\u751F\u6210\r\n */\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        keyData,\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n", "/**\r\n * Shopee Product Update API\r\n * \r\n * \u5546\u54C1\u60C5\u5831\u3092Shopee API\u306B\u9001\u4FE1\u3057\u3066\u66F4\u65B0\u3057\u307E\u3059\r\n * - update_item (\u5546\u54C1\u540D\u3001\u8AAC\u660E\u306A\u3069)\r\n * - update_price (\u4FA1\u683C)\r\n * - update_stock (\u5728\u5EAB)\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n    DB: D1Database;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    if (request.method !== \"POST\") {\r\n        return errorResponse(\"Method not allowed\", 405);\r\n    }\r\n\r\n    try {\r\n        const body = await request.json() as {\r\n            access_token: string;\r\n            shop_id: number;\r\n            item_id: number;\r\n            update_type: 'item' | 'price' | 'stock' | 'all';\r\n            // \u5546\u54C1\u60C5\u5831\r\n            item_name?: string;\r\n            description?: string;\r\n            // \u4FA1\u683C\r\n            price?: number;\r\n            // \u5728\u5EAB\r\n            stock?: number;\r\n        };\r\n\r\n        const { access_token, shop_id, item_id, update_type } = body;\r\n\r\n        if (!access_token || !shop_id || !item_id) {\r\n            return errorResponse(\"access_token, shop_id, item_id are required\", 400);\r\n        }\r\n\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n        const results: any = {};\r\n\r\n        // \u5546\u54C1\u60C5\u5831\u306E\u66F4\u65B0\r\n        if (update_type === 'item' || update_type === 'all') {\r\n            if (body.item_name || body.description) {\r\n                const updateData: any = { item_id };\r\n                if (body.item_name) updateData.item_name = body.item_name;\r\n                if (body.description) updateData.description = body.description;\r\n\r\n                results.item = await callShopeeApi(\r\n                    partnerId,\r\n                    partnerKey,\r\n                    access_token,\r\n                    shop_id,\r\n                    \"/api/v2/product/update_item\",\r\n                    updateData\r\n                );\r\n            }\r\n        }\r\n\r\n        // \u4FA1\u683C\u306E\u66F4\u65B0\r\n        if ((update_type === 'price' || update_type === 'all') && body.price !== undefined) {\r\n            results.price = await callShopeeApi(\r\n                partnerId,\r\n                partnerKey,\r\n                access_token,\r\n                shop_id,\r\n                \"/api/v2/product/update_price\",\r\n                {\r\n                    item_id,\r\n                    price_list: [{\r\n                        model_id: 0,\r\n                        original_price: body.price\r\n                    }]\r\n                }\r\n            );\r\n        }\r\n\r\n        // \u5728\u5EAB\u306E\u66F4\u65B0\r\n        if ((update_type === 'stock' || update_type === 'all') && body.stock !== undefined) {\r\n            results.stock = await callShopeeApi(\r\n                partnerId,\r\n                partnerKey,\r\n                access_token,\r\n                shop_id,\r\n                \"/api/v2/product/update_stock\",\r\n                {\r\n                    item_id,\r\n                    stock_list: [{\r\n                        model_id: 0,\r\n                        seller_stock: [{\r\n                            stock: body.stock\r\n                        }]\r\n                    }]\r\n                }\r\n            );\r\n        }\r\n\r\n        // \u30A8\u30E9\u30FC\u30C1\u30A7\u30C3\u30AF\r\n        const hasError = Object.values(results).some((r: any) => r?.error);\r\n\r\n        if (hasError) {\r\n            return new Response(JSON.stringify({\r\n                status: \"partial_error\",\r\n                message: \"Some updates failed\",\r\n                data: results\r\n            }), {\r\n                status: 207,\r\n                headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n            });\r\n        }\r\n\r\n        return new Response(JSON.stringify({\r\n            status: \"success\",\r\n            message: \"Product updated on Shopee\",\r\n            data: results\r\n        }), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Update error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\n/**\r\n * Shopee API\u3092\u547C\u3073\u51FA\u3059\u6C4E\u7528\u95A2\u6570\r\n */\r\nasync function callShopeeApi(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    accessToken: string,\r\n    shopId: number,\r\n    path: string,\r\n    body: any\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n    // \u7F72\u540D\u8A08\u7B97: partner_id + path + timestamp + access_token + shop_id\r\n    const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    const url = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&access_token=${accessToken}&shop_id=${shopId}&sign=${sign}`;\r\n\r\n    const response = await fetch(url, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(body),\r\n    });\r\n\r\n    return await response.json();\r\n}\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        keyData,\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee Image Upload API\r\n * \r\n * Shopee Media Space\u3078\u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3057\u307E\u3059\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 204, headers: getCorsHeaders() });\r\n    }\r\n\r\n    if (request.method !== \"POST\") {\r\n        return errorResponse(\"Method not allowed\", 405);\r\n    }\r\n\r\n    try {\r\n        const url = new URL(request.url);\r\n        const accessToken = url.searchParams.get(\"access_token\");\r\n        const shopId = url.searchParams.get(\"shop_id\");\r\n\r\n        if (!accessToken || !shopId) {\r\n            return errorResponse(\"access_token and shop_id are required\", 400);\r\n        }\r\n\r\n        const formData = await request.formData();\r\n        const image = formData.get(\"image\");\r\n\r\n        if (!image) {\r\n            return errorResponse(\"image file is required\", 400);\r\n        }\r\n\r\n        const partnerId = env.SHOPEE_PARTNER_ID;\r\n        const partnerKey = env.SHOPEE_PARTNER_KEY;\r\n\r\n        const path = \"/api/v2/media_space/upload_image\";\r\n        const timestamp = Math.floor(Date.now() / 1000);\r\n\r\n        // \u7F72\u540D\u8A08\u7B97\r\n        const baseString = `${partnerId}${path}${timestamp}${accessToken}${shopId}`;\r\n        const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n        const apiUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&access_token=${accessToken}&shop_id=${shopId}&sign=${sign}`;\r\n\r\n        // FormData\u306E\u518D\u69CB\u7BC9\r\n        const shopeeBody = new FormData();\r\n        shopeeBody.append(\"image\", image);\r\n\r\n        const response = await fetch(apiUrl, {\r\n            method: \"POST\",\r\n            body: shopeeBody\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        return new Response(JSON.stringify(data), {\r\n            status: 200,\r\n            headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Upload error:\", error);\r\n        return errorResponse(`Server Error: ${error}`, 500);\r\n    }\r\n};\r\n\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\", keyData, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    };\r\n}\r\n\r\nfunction errorResponse(message: string, status: number): Response {\r\n    return new Response(JSON.stringify({ status: \"error\", message }), {\r\n        status,\r\n        headers: { \"Content-Type\": \"application/json\", ...getCorsHeaders() },\r\n    });\r\n}\r\n", "/**\r\n * Shopee API Callback Handler (D1\u6C38\u7D9A\u5316\u5BFE\u5FDC\u7248)\r\n * \r\n * \u3053\u306E\u30A8\u30F3\u30C9\u30DD\u30A4\u30F3\u30C8\u306F\u4EE5\u4E0B\u306E\u76EE\u7684\u3067\u4F7F\u7528\u3055\u308C\u307E\u3059\uFF1A\r\n * 1. Shopee\u30B5\u30FC\u30D0\u30FC\u304B\u3089\u306E\u758E\u901A\u78BA\u8A8D\uFF08Verification\uFF09\r\n * 2. OAuth\u8A8D\u53EF\u30B3\u30FC\u30C9\u306E\u53D7\u3051\u53D6\u308A \u2192 Access Token\u53D6\u5F97\r\n * 3. \u30C8\u30FC\u30AF\u30F3\u3092D1\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u306B\u6C38\u7D9A\u4FDD\u5B58\r\n * 4. \u30D7\u30C3\u30B7\u30E5\u901A\u77E5\u306E\u53D7\u4FE1\r\n */\r\n\r\ninterface Env {\r\n    SHOPEE_PARTNER_ID: string;\r\n    SHOPEE_PARTNER_KEY: string;\r\n    DB: D1Database;\r\n}\r\n\r\nconst SHOPEE_HOST = \"https://partner.shopeemobile.com\";\r\n\r\nexport const onRequest: PagesFunction<Env> = async (context) => {\r\n    const { request, env } = context;\r\n    const url = new URL(request.url);\r\n\r\n    // CORS\u30D7\u30EA\u30D5\u30E9\u30A4\u30C8\u30EA\u30AF\u30A8\u30B9\u30C8\u3078\u306E\u5BFE\u5FDC\r\n    if (request.method === \"OPTIONS\") {\r\n        return new Response(null, {\r\n            status: 204,\r\n            headers: getCorsHeaders(),\r\n        });\r\n    }\r\n\r\n    // \u30AF\u30A8\u30EA\u30D1\u30E9\u30E1\u30FC\u30BF\u3092\u53D6\u5F97\uFF08OAuth\u8A8D\u53EF\u30B3\u30FC\u30C9\u7528\uFF09\r\n    const code = url.searchParams.get(\"code\");\r\n    const shopId = url.searchParams.get(\"shop_id\");\r\n    const mainAccountId = url.searchParams.get(\"main_account_id\");\r\n\r\n    // \u30EA\u30AF\u30A8\u30B9\u30C8\u60C5\u5831\u3092\u30ED\u30B0\u51FA\u529B\r\n    console.log(\"========== Shopee Callback Received ==========\");\r\n    console.log(`Timestamp: ${new Date().toISOString()}`);\r\n    console.log(`Method: ${request.method}`);\r\n    console.log(`Code: ${code || \"N/A\"}`);\r\n    console.log(`Shop ID: ${shopId || \"N/A\"}`);\r\n    console.log(`Main Account ID: ${mainAccountId || \"N/A\"}`);\r\n\r\n    // \u8A8D\u53EF\u30B3\u30FC\u30C9\u304C\u3042\u308B\u5834\u5408\u306FAccess Token\u3092\u53D6\u5F97\r\n    if (code && shopId) {\r\n        try {\r\n            const tokenResult = await getAccessToken(\r\n                env.SHOPEE_PARTNER_ID,\r\n                env.SHOPEE_PARTNER_KEY,\r\n                code,\r\n                parseInt(shopId)\r\n            );\r\n\r\n            console.log(\"Token Result:\", JSON.stringify(tokenResult, null, 2));\r\n\r\n            // \u30C8\u30FC\u30AF\u30F3\u53D6\u5F97\u6210\u529F\u6642\u3001D1\u306B\u4FDD\u5B58\r\n            let d1Saved = false;\r\n            let d1Error = null;\r\n\r\n            if (!tokenResult.error && tokenResult.access_token) {\r\n                try {\r\n                    await saveTokenToD1(env.DB, {\r\n                        shop_id: parseInt(shopId),\r\n                        access_token: tokenResult.access_token,\r\n                        refresh_token: tokenResult.refresh_token,\r\n                        expire_in: tokenResult.expire_in,\r\n                        shop_name: null\r\n                    });\r\n                    d1Saved = true;\r\n                    console.log(\"Token saved to D1 successfully\");\r\n                } catch (e) {\r\n                    d1Error = String(e);\r\n                    console.error(\"D1 save error:\", e);\r\n                }\r\n            }\r\n\r\n            // \u6210\u529F\u30DA\u30FC\u30B8\u3092\u8FD4\u3059\uFF08D1\u4FDD\u5B58\u72B6\u614B\u3082\u8868\u793A\uFF09\r\n            return new Response(generateSuccessHtml(tokenResult, shopId, d1Saved, d1Error), {\r\n                status: 200,\r\n                headers: {\r\n                    \"Content-Type\": \"text/html; charset=utf-8\",\r\n                    ...getCorsHeaders(),\r\n                },\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error(\"Token\u53D6\u5F97\u30A8\u30E9\u30FC:\", error);\r\n            return new Response(generateErrorHtml(String(error)), {\r\n                status: 500,\r\n                headers: {\r\n                    \"Content-Type\": \"text/html; charset=utf-8\",\r\n                    ...getCorsHeaders(),\r\n                },\r\n            });\r\n        }\r\n    }\r\n\r\n    // POST\u30EA\u30AF\u30A8\u30B9\u30C8\u306E\u5834\u5408\u306F\u30DC\u30C7\u30A3\u3082\u53D6\u5F97\uFF08\u30D7\u30C3\u30B7\u30E5\u901A\u77E5\u7528\uFF09\r\n    let requestBody = null;\r\n    if (request.method === \"POST\") {\r\n        try {\r\n            requestBody = await request.json();\r\n            console.log(\"Request Body:\", JSON.stringify(requestBody, null, 2));\r\n        } catch (e) {\r\n            console.log(\"Request body is not JSON or empty\");\r\n        }\r\n    }\r\n\r\n    console.log(\"===============================================\");\r\n\r\n    // \u901A\u5E38\u306E\u30EC\u30B9\u30DD\u30F3\u30B9\r\n    const responseData = {\r\n        status: \"success\",\r\n        message: \"Shopee callback received\",\r\n        timestamp: new Date().toISOString(),\r\n        data: {\r\n            code: code || null,\r\n            shopId: shopId || null,\r\n            mainAccountId: mainAccountId || null,\r\n        },\r\n    };\r\n\r\n    return new Response(JSON.stringify(responseData), {\r\n        status: 200,\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            ...getCorsHeaders(),\r\n        },\r\n    });\r\n};\r\n\r\n/**\r\n * \u30C8\u30FC\u30AF\u30F3\u3092D1\u306B\u4FDD\u5B58\r\n */\r\nasync function saveTokenToD1(db: D1Database, data: {\r\n    shop_id: number;\r\n    access_token: string;\r\n    refresh_token: string;\r\n    expire_in: number;\r\n    shop_name: string | null;\r\n}): Promise<void> {\r\n    // \u6709\u52B9\u671F\u9650\u3092\u8A08\u7B97\uFF08\u79D2\u5358\u4F4D\u3067\u8FD4\u3063\u3066\u304F\u308B\uFF09\r\n    const accessExpires = new Date(Date.now() + (data.expire_in * 1000)).toISOString();\r\n    const refreshExpires = new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString(); // 30\u65E5\r\n\r\n    await db.prepare(`\r\n        INSERT INTO tokens (shop_id, access_token, refresh_token, access_token_expires_at, refresh_token_expires_at, shop_name, region)\r\n        VALUES (?, ?, ?, ?, ?, ?, 'TW')\r\n        ON CONFLICT(shop_id) DO UPDATE SET\r\n            access_token = excluded.access_token,\r\n            refresh_token = excluded.refresh_token,\r\n            access_token_expires_at = excluded.access_token_expires_at,\r\n            refresh_token_expires_at = excluded.refresh_token_expires_at,\r\n            updated_at = datetime('now')\r\n    `).bind(\r\n        data.shop_id,\r\n        data.access_token,\r\n        data.refresh_token,\r\n        accessExpires,\r\n        refreshExpires,\r\n        data.shop_name\r\n    ).run();\r\n}\r\n\r\n/**\r\n * \u8A8D\u53EF\u30B3\u30FC\u30C9\u304B\u3089Access Token\u3092\u53D6\u5F97\r\n */\r\nasync function getAccessToken(\r\n    partnerId: string,\r\n    partnerKey: string,\r\n    code: string,\r\n    shopId: number\r\n): Promise<any> {\r\n    const timestamp = Math.floor(Date.now() / 1000);\r\n    const path = \"/api/v2/auth/token/get\";\r\n\r\n    // \u7F72\u540D\u8A08\u7B97: partner_id + path + timestamp\r\n    const baseString = `${partnerId}${path}${timestamp}`;\r\n    const sign = await hmacSha256(partnerKey, baseString);\r\n\r\n    const tokenUrl = `${SHOPEE_HOST}${path}?partner_id=${partnerId}&timestamp=${timestamp}&sign=${sign}`;\r\n\r\n    const response = await fetch(tokenUrl, {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n            code: code,\r\n            shop_id: shopId,\r\n            partner_id: parseInt(partnerId),\r\n        }),\r\n    });\r\n\r\n    const result = await response.json();\r\n    return result;\r\n}\r\n\r\n/**\r\n * HMAC-SHA256\u7F72\u540D\u3092\u751F\u6210\r\n */\r\nasync function hmacSha256(key: string, message: string): Promise<string> {\r\n    const encoder = new TextEncoder();\r\n    const keyData = encoder.encode(key);\r\n    const messageData = encoder.encode(message);\r\n\r\n    const cryptoKey = await crypto.subtle.importKey(\r\n        \"raw\",\r\n        keyData,\r\n        { name: \"HMAC\", hash: \"SHA-256\" },\r\n        false,\r\n        [\"sign\"]\r\n    );\r\n\r\n    const signature = await crypto.subtle.sign(\"HMAC\", cryptoKey, messageData);\r\n    const hashArray = Array.from(new Uint8Array(signature));\r\n    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\n/**\r\n * \u6210\u529F\u6642\u306EHTML\u3092\u751F\u6210\uFF08D1\u4FDD\u5B58\u72B6\u614B\u3082\u8868\u793A\uFF09\r\n */\r\nfunction generateSuccessHtml(tokenResult: any, shopId: string, d1Saved: boolean, d1Error: string | null): string {\r\n    const isSuccess = !tokenResult.error;\r\n\r\n    return `<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Shopee \u8A8D\u8A3C${isSuccess ? '\u6210\u529F' : '\u5931\u6557'}</title>\r\n    <style>\r\n        body {\r\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\r\n            color: #fff;\r\n            min-height: 100vh;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            margin: 0;\r\n            padding: 20px;\r\n        }\r\n        .container {\r\n            background: rgba(255,255,255,0.1);\r\n            padding: 40px;\r\n            border-radius: 16px;\r\n            max-width: 600px;\r\n            text-align: center;\r\n            backdrop-filter: blur(10px);\r\n        }\r\n        .icon { font-size: 64px; margin-bottom: 20px; }\r\n        h1 { color: ${isSuccess ? '#22c55e' : '#ef4444'}; margin: 0 0 20px; }\r\n        .info { background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; text-align: left; margin: 20px 0; }\r\n        .label { color: #888; font-size: 12px; }\r\n        .value { font-family: monospace; word-break: break-all; }\r\n        pre { text-align: left; overflow: auto; background: #000; padding: 10px; border-radius: 8px; font-size: 12px; }\r\n        .d1-status { \r\n            padding: 15px; \r\n            border-radius: 8px; \r\n            margin: 20px 0;\r\n            text-align: center;\r\n        }\r\n        .d1-success { background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; }\r\n        .d1-error { background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; }\r\n        .btn {\r\n            display: inline-block;\r\n            padding: 12px 24px;\r\n            background: #6366f1;\r\n            color: white;\r\n            text-decoration: none;\r\n            border-radius: 8px;\r\n            margin-top: 20px;\r\n            font-weight: 600;\r\n        }\r\n        .btn:hover { background: #4f46e5; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"container\">\r\n        <div class=\"icon\">${isSuccess ? '\u2705' : '\u274C'}</div>\r\n        <h1>${isSuccess ? '\u30B7\u30E7\u30C3\u30D7\u8A8D\u8A3C\u5B8C\u4E86\uFF01' : '\u8A8D\u8A3C\u30A8\u30E9\u30FC'}</h1>\r\n        <div class=\"info\">\r\n            <div class=\"label\">Shop ID</div>\r\n            <div class=\"value\">${shopId}</div>\r\n        </div>\r\n        ${isSuccess ? `\r\n        <div class=\"info\">\r\n            <div class=\"label\">Access Token</div>\r\n            <div class=\"value\">${tokenResult.access_token || 'N/A'}</div>\r\n        </div>\r\n        <div class=\"info\">\r\n            <div class=\"label\">Refresh Token</div>\r\n            <div class=\"value\">${tokenResult.refresh_token || 'N/A'}</div>\r\n        </div>\r\n        <div class=\"info\">\r\n            <div class=\"label\">\u6709\u52B9\u671F\u9650</div>\r\n            <div class=\"value\">${tokenResult.expire_in ? Math.floor(tokenResult.expire_in / 3600) + '\u6642\u9593' : 'N/A'}</div>\r\n        </div>\r\n        \r\n        <!-- D1\u4FDD\u5B58\u72B6\u614B -->\r\n        <div class=\"d1-status ${d1Saved ? 'd1-success' : 'd1-error'}\">\r\n            ${d1Saved\r\n                ? '\uD83D\uDCBE \u30C8\u30FC\u30AF\u30F3\u306FD1\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u306B\u6C38\u7D9A\u4FDD\u5B58\u3055\u308C\u307E\u3057\u305F\uFF01'\r\n                : `\u26A0\uFE0F D1\u4FDD\u5B58\u30A8\u30E9\u30FC: ${d1Error || '\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u306B\u63A5\u7D9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u30B9\u30AD\u30FC\u30DE\u304C\u9069\u7528\u3055\u308C\u3066\u3044\u308B\u304B\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002'}`\r\n            }\r\n        </div>\r\n        ` : ''}\r\n        <details>\r\n            <summary>\u8A73\u7D30\u30EC\u30B9\u30DD\u30F3\u30B9</summary>\r\n            <pre>${JSON.stringify(tokenResult, null, 2)}</pre>\r\n        </details>\r\n        <a href=\"/\" class=\"btn\">\uD83C\uDFE0 \u30C0\u30C3\u30B7\u30E5\u30DC\u30FC\u30C9\u3078</a>\r\n    </div>\r\n    \r\n    ${isSuccess ? `\r\n    <script>\r\n        // localStorage\u306B\u3082\u4FDD\u5B58\uFF08\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\uFF09\r\n        try {\r\n            localStorage.setItem('shopee_auth', JSON.stringify({\r\n                shopId: '${shopId}',\r\n                accessToken: '${tokenResult.access_token || ''}',\r\n                refreshToken: '${tokenResult.refresh_token || ''}',\r\n                shopName: null,\r\n                connectedAt: new Date().toISOString()\r\n            }));\r\n            console.log('Saved to localStorage as backup');\r\n        } catch(e) {\r\n            console.error('localStorage save error:', e);\r\n        }\r\n    </script>\r\n    ` : ''}\r\n</body>\r\n</html>`;\r\n}\r\n\r\n/**\r\n * \u30A8\u30E9\u30FC\u6642\u306EHTML\u3092\u751F\u6210\r\n */\r\nfunction generateErrorHtml(error: string): string {\r\n    return `<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <title>\u30A8\u30E9\u30FC</title>\r\n    <style>\r\n        body { font-family: sans-serif; background: #1a1a2e; color: #fff; display: flex; align-items: center; justify-content: center; min-height: 100vh; }\r\n        .container { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 16px; text-align: center; }\r\n        h1 { color: #ef4444; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"container\">\r\n        <h1>\u274C \u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F</h1>\r\n        <p>${error}</p>\r\n    </div>\r\n</body>\r\n</html>`;\r\n}\r\n\r\n/**\r\n * CORS\u30D8\u30C3\u30C0\u30FC\u3092\u53D6\u5F97\r\n */\r\nfunction getCorsHeaders(): Record<string, string> {\r\n    return {\r\n        \"Access-Control-Allow-Origin\": \"*\",\r\n        \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\r\n        \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\r\n        \"Access-Control-Max-Age\": \"86400\",\r\n    };\r\n}\r\n", "import { onRequest as __api_ai_translate_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\ai\\\\translate.ts\"\nimport { onRequest as __api_db_price_rules_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\db\\\\price-rules.ts\"\nimport { onRequest as __api_db_products_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\db\\\\products.ts\"\nimport { onRequest as __api_db_sync_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\db\\\\sync.ts\"\nimport { onRequest as __api_db_tokens_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\db\\\\tokens.ts\"\nimport { onRequest as __api_shopee_add_item_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\add_item.ts\"\nimport { onRequest as __api_shopee_attributes_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\attributes.ts\"\nimport { onRequest as __api_shopee_auth_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\auth.ts\"\nimport { onRequest as __api_shopee_categories_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\categories.ts\"\nimport { onRequest as __api_shopee_exchange_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\exchange.ts\"\nimport { onRequest as __api_shopee_item_detail_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\item_detail.ts\"\nimport { onRequest as __api_shopee_logistics_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\logistics.ts\"\nimport { onRequest as __api_shopee_orders_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\orders.ts\"\nimport { onRequest as __api_shopee_products_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\products.ts\"\nimport { onRequest as __api_shopee_test_connection_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\test-connection.ts\"\nimport { onRequest as __api_shopee_update_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\update.ts\"\nimport { onRequest as __api_shopee_upload_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\shopee\\\\upload.ts\"\nimport { onRequest as __api_callback_ts_onRequest } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\functions\\\\api\\\\callback.ts\"\n\nexport const routes = [\n    {\n      routePath: \"/api/ai/translate\",\n      mountPath: \"/api/ai\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_ai_translate_ts_onRequest],\n    },\n  {\n      routePath: \"/api/db/price-rules\",\n      mountPath: \"/api/db\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_db_price_rules_ts_onRequest],\n    },\n  {\n      routePath: \"/api/db/products\",\n      mountPath: \"/api/db\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_db_products_ts_onRequest],\n    },\n  {\n      routePath: \"/api/db/sync\",\n      mountPath: \"/api/db\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_db_sync_ts_onRequest],\n    },\n  {\n      routePath: \"/api/db/tokens\",\n      mountPath: \"/api/db\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_db_tokens_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/add_item\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_add_item_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/attributes\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_attributes_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/auth\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_auth_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/categories\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_categories_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/exchange\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_exchange_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/item_detail\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_item_detail_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/logistics\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_logistics_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/orders\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_orders_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/products\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_products_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/test-connection\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_test_connection_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/update\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_update_ts_onRequest],\n    },\n  {\n      routePath: \"/api/shopee/upload\",\n      mountPath: \"/api/shopee\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_shopee_upload_ts_onRequest],\n    },\n  {\n      routePath: \"/api/callback\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_callback_ts_onRequest],\n    },\n  ]", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  const isSafe = (value: string): boolean => {\n    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n    return false;\n  };\n\n  const safePattern = (prefix: string) => {\n    const prev = result[result.length - 1];\n    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n\n    if (prev && !prevText) {\n      throw new TypeError(\n        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n      );\n    }\n\n    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || safePattern(prefix),\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? safePattern(prefix) : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions,\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {},\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`,\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string,\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions,\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {},\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {},\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            throw new TypeError(\n              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n            );\n          }\n\n          route += `(${token.pattern})${token.modifier}`;\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "import { match } from \"path-to-regexp\";\n\n//note: this explicitly does not include the * character, as pages requires this\nconst escapeRegex = /[.+?^${}()|[\\]\\\\]/g;\n\ntype HTTPMethod =\n\t| \"HEAD\"\n\t| \"OPTIONS\"\n\t| \"GET\"\n\t| \"POST\"\n\t| \"PUT\"\n\t| \"PATCH\"\n\t| \"DELETE\";\n\n/* TODO: Grab these from @cloudflare/workers-types instead */\ntype Params<P extends string = string> = Record<P, string | string[]>;\n\ntype EventContext<Env, P extends string, Data> = {\n\trequest: Request;\n\tfunctionPath: string;\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n\tnext: (input?: Request | string, init?: RequestInit) => Promise<Response>;\n\tenv: Env & { ASSETS: { fetch: typeof fetch } };\n\tparams: Params<P>;\n\tdata: Data;\n};\n\ndeclare type PagesFunction<\n\tEnv = unknown,\n\tP extends string = string,\n\tData extends Record<string, unknown> = Record<string, unknown>,\n> = (context: EventContext<Env, P, Data>) => Response | Promise<Response>;\n/* end @cloudflare/workers-types */\n\ntype RouteHandler = {\n\troutePath: string;\n\tmountPath: string;\n\tmethod?: HTTPMethod;\n\tmodules: PagesFunction[];\n\tmiddlewares: PagesFunction[];\n};\n\n// inject `routes` via ESBuild\ndeclare const routes: RouteHandler[];\n// define `__FALLBACK_SERVICE__` via ESBuild\ndeclare const __FALLBACK_SERVICE__: string;\n\n// expect an ASSETS fetcher binding pointing to the asset-server stage\ntype FetchEnv = {\n\t[name: string]: { fetch: typeof fetch };\n\tASSETS: { fetch: typeof fetch };\n};\n\ntype WorkerContext = {\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n};\n\nfunction* executeRequest(request: Request) {\n\tconst requestPath = new URL(request.url).pathname;\n\n\t// First, iterate through the routes (backwards) and execute \"middlewares\" on partial route matches\n\tfor (const route of [...routes].reverse()) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// replaces with \"\\\\$&\", this prepends a backslash to the matched string, e.g. \"[\" becomes \"\\[\"\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult) {\n\t\t\tfor (const handler of route.middlewares.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: mountMatchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// Then look for the first exact route match and execute its \"modules\"\n\tfor (const route of routes) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: true,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult && route.modules.length) {\n\t\t\tfor (const handler of route.modules.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: matchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport default {\n\tasync fetch(\n\t\toriginalRequest: Request,\n\t\tenv: FetchEnv,\n\t\tworkerContext: WorkerContext\n\t) {\n\t\tlet request = originalRequest;\n\t\tconst handlerIterator = executeRequest(request);\n\t\tlet data = {}; // arbitrary data the user can set between functions\n\t\tlet isFailOpen = false;\n\n\t\tconst next = async (input?: RequestInfo, init?: RequestInit) => {\n\t\t\tif (input !== undefined) {\n\t\t\t\tlet url = input;\n\t\t\t\tif (typeof input === \"string\") {\n\t\t\t\t\turl = new URL(input, request.url).toString();\n\t\t\t\t}\n\t\t\t\trequest = new Request(url, init);\n\t\t\t}\n\n\t\t\tconst result = handlerIterator.next();\n\t\t\t// Note we can't use `!result.done` because this doesn't narrow to the correct type\n\t\t\tif (result.done === false) {\n\t\t\t\tconst { handler, params, path } = result.value;\n\t\t\t\tconst context = {\n\t\t\t\t\trequest: new Request(request.clone()),\n\t\t\t\t\tfunctionPath: path,\n\t\t\t\t\tnext,\n\t\t\t\t\tparams,\n\t\t\t\t\tget data() {\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t},\n\t\t\t\t\tset data(value) {\n\t\t\t\t\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\t\t\t\t\tthrow new Error(\"context.data must be an object\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// user has overriden context.data, so we need to merge it with the existing data\n\t\t\t\t\t\tdata = value;\n\t\t\t\t\t},\n\t\t\t\t\tenv,\n\t\t\t\t\twaitUntil: workerContext.waitUntil.bind(workerContext),\n\t\t\t\t\tpassThroughOnException: () => {\n\t\t\t\t\t\tisFailOpen = true;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst response = await handler(context);\n\n\t\t\t\tif (!(response instanceof Response)) {\n\t\t\t\t\tthrow new Error(\"Your Pages function should return a Response\");\n\t\t\t\t}\n\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else if (__FALLBACK_SERVICE__) {\n\t\t\t\t// There are no more handlers so finish with the fallback service (`env.ASSETS.fetch` in Pages' case)\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else {\n\t\t\t\t// There was not fallback service so actually make the request to the origin.\n\t\t\t\tconst response = await fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\treturn await next();\n\t\t} catch (error) {\n\t\t\tif (isFailOpen) {\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t},\n};\n\n// This makes a Response mutable\nconst cloneResponse = (response: Response) =>\n\t// https://fetch.spec.whatwg.org/#null-body-status\n\tnew Response(\n\t\t[101, 204, 205, 304].includes(response.status) ? null : response.body,\n\t\tresponse\n\t);\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\bundle-Omh87Y\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\bundle-Omh87Y\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\bundle-Omh87Y\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\pages-cxfEwt\\\\functionsWorker-0.13440977921841457.mjs\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\pages-cxfEwt\\\\functionsWorker-0.13440977921841457.mjs\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\bundle-FuOJHY\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\bundle-FuOJHY\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\buyse\\\\OneDrive\\\\\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\\\\Antigravity\\\\Shopee Auto\\\\project\\\\.wrangler\\\\tmp\\\\bundle-FuOJHY\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["urls", "checkURL", "__name", "onRequest", "getCorsHeaders", "errorResponse", "handleGet", "handlePost", "handlePut", "handleDelete", "jsonResponse", "SHOPEE_HOST", "hmacSha256", "getItemBaseInfo", "products", "getItemList", "getAccessToken", "saveTokenToD1", "value", "_a", "result", "char", "prefix", "i", "drainBody", "middleware_ensure_req_body_drained_default", "reduceError", "jsonError", "middleware_miniflare3_json_error_default", "__INTERNAL_WRANGLER_MIDDLEWARE__", "middleware_ensure_req_body_drained_default", "middleware_miniflare3_json_error_default", "middleware_insertion_facade_default", "__facade_middleware__", "__facade_register__", "__facade_invokeChain__", "__facade_invoke__", "__facade_middleware__", "__Facade_ScheduledController__", "___Facade_ScheduledController__", "wrapExportedHandler", "__INTERNAL_WRANGLER_MIDDLEWARE__", "__facade_register__", "__facade_invoke__", "wrapWorkerEntrypoint", "WRAPPED_ENTRY", "middleware_insertion_facade_default", "middleware_loader_entry_default"]
}
